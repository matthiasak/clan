{"version":3,"sources":["index.js","batch.js","vdom.js","mixin.js","model.js","observable.js","hamt.js","worker.js","fp.js"],"names":["hamt","worker","fp","hash","v","_v","JSON","stringify","i","len","length","c","charCodeAt","module","exports","batch","vdom","mixin","model","obs","inflight","url","options","method","key","toLowerCase","f","Object","assign","compress","Promise","res","rej","then","d","catch","e","undefined","data","console","error","rAF","document","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","setTimeout","cb","class_id_regex","tagName_regex","parseSelector","test","tagreg","exec","s","tag","slice","reg","create","substr","className","trim","id","debounce","func","wait","immediate","timeout","args","later","callNow","clearTimeout","m","selector","children","attrs","Array","Function","unshift","shouldUpdate","unload","config","__hash","stripEvents","a","name","applyEvents","events","el","strip_existing","removeEvents","flatten","arr","push","EVENTS","split","map","x","mnt","mount","fn","render","applyUpdates","update","stylify","style","setAttrs","attr","innerHTML","value","setAttribute","_id","_className","createTag","parent","parentElement","__vdom","t","createTextNode","insertBefore","removeEl","appendChild","shouldExchange","tagName","_shouldUpdate","createElement","removeChild","insertAt","next_sib","resolve","_el","vdom_children","el_children","childNodes","qs","querySelector","resolver","states","promises","done","_await","_promises","finish","ms","isDone","total","all","props","keys","forEach","getState","gs","view","state","r","instance","container","queries","wrapper_view","reservedAttrs","toHTML","_vdom","html","_class","_attrs","inner","indexOf","str","filter","join","classes","_mixin","proto","prototype","p","getOwnPropertyNames","oldFn","apply","call","arguments","is","type","isValid","String","Number","Boolean","check","types","required","reduce","_type","MODEL","init","logic","pipe","whenValid","ArrayOf","M","subscribers","val","o","take","n","values","delete","takeWhile","acc","maybe","success","stop","ts","Date","now","from","union","fs","hamming","popcount","root","sum","comp","b","HMAP_SIZE","MAX_DEPTH","vec","h","range","shallowClone","y","cloneNode","node","numChildren","set","newroot","bits","cp","cn","rh","j","__r","__n","vecr","vecn","_r","get","first","unset","_n","item","toList","toOrderedList","toJSON","toJson","pop","shift","k","supports","q","window","supportsWorkers","supportsBlobs","supportsURLs","supportsBuilders","code","B","U","W","blob","append","getBlob","encodeURIComponent","createObjectURL","Worker","farm","workers","fill","current","iter","onerror","w","onmessage","postMessage","log","process","nextTick","g","cof","fns","cob","reverse","pf","curry","bind","mapping","mapper","reducer","result","filtering","predicate","concatter","thing","concat"],"mappings":"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","file":"","sourcesContent":["import batch from './batch'\nimport vdom from './vdom'\nimport mixin from './mixin'\nimport model from './model'\nimport obs from './observable'\nimport * as hamt from './hamt'\nimport * as worker from './worker'\nimport * as fp from './fp'\n\nexport const hash = (v,_v=JSON.stringify(v)) => {\n    let hash = 0\n    for (let i = 0, len = _v.length; i < len; ++i) {\n        const c = _v.charCodeAt(i)\n        hash = (((hash << 5) - hash) + c) | 0\n    }\n    return hash\n}\n\nmodule.exports = {\n\tbatch\n\t, vdom\n\t, mixin\n\t, model\n\t, obs\n\t, hamt\n\t, worker\n\t, fp\n}\n","\n// batched requests\n// The `fetch()` module batches in-flight requests, so if at any point in time, anywhere in my front-end or\n// back-end application I have a calls occur to `fetch('http://api.github.com/users/matthiasak')` while another\n// to that URL is \"in-flight\", the Promise returned by both of those calls will be resolved by a single network request.\n\n// f :: (url -> options) -> Promise\nconst batch = f => {\n    let inflight = {}\n\n    return (url, options={}) => {\n        let {method} = options,\n            key = `${url}:${JSON.stringify(options)}`\n\n        if((method || '').toLowerCase() === 'post')\n            return f(url, Object.assign({}, options, {compress: false}))\n\n        return inflight[key] ||\n            (inflight[key] =\n                new Promise((res,rej) => {\n                    f(url, Object.assign({}, options, {compress: false}))\n                    .then(d => res(d))\n                    .catch(e => rej(e))\n                })\n                .then(data => {\n                    inflight = Object.assign({}, inflight, {[key]: undefined})\n                    return data\n                })\n                .catch(e =>\n                    console.error(e, url)))\n    }\n}\n\nexport default batch","const rAF =\n      typeof document !== 'undefined' &&\n      (requestAnimationFrame ||\n      webkitRequestAnimationFrame ||\n      mozRequestAnimationFrame) ||\n      (cb => setTimeout(cb, 16.6))\n\n// Virtual DOMs\nconst vdom = () => {\n    const class_id_regex = () => {\n            return /[#\\.][^#\\.]+/ig\n        },\n        tagName_regex = () => {\n            return /^([^\\.#]+)\\b/i\n        }\n\n    const parseSelector = s => {\n        let test = null,\n            tagreg = tagName_regex().exec(s),\n            tag = tagreg && tagreg.slice(1)[0],\n            reg = class_id_regex(),\n            vdom = Object.create(null)\n\n        if(tag) s = s.substr(tag.length)\n        vdom.className = ''\n        vdom.tag = tag || 'div'\n\n        while((test = reg.exec(s)) !== null){\n            test = test[0]\n            if(test[0] === '.')\n                vdom.className = (vdom.className+' '+test.substr(1)).trim()\n            else if(test[0] === '#')\n                vdom.id = test.substr(1)\n        }\n        return vdom\n    }\n\n    const debounce = (func, wait, immediate, timeout) =>\n        (...args) => {\n            let later = () => {\n                timeout = null\n                !immediate && func(...args)\n            }\n            var callNow = immediate && !timeout\n            clearTimeout(timeout)\n            timeout = setTimeout(later, wait || 0)\n            callNow && func(...args)\n        }\n\n    const hash = (v,_v=JSON.stringify(v)) => {\n        let hash = 0\n        for (let i = 0, len = _v.length; i < len; ++i) {\n            const c = _v.charCodeAt(i)\n            hash = (((hash << 5) - hash) + c) | 0\n        }\n        return hash\n    }\n\n    const m = (selector, attrs=Object.create(null), ...children) => {\n        if(attrs.tag || !(typeof attrs === 'object') || attrs instanceof Array || attrs instanceof Function){\n            if(attrs instanceof Array) children.unshift(...attrs)\n            else children.unshift(attrs)\n            attrs = Object.create(null)\n        }\n        let vdom = parseSelector(selector)\n        if(children.length)\n            vdom.children = children\n        vdom.attrs = attrs\n        vdom.shouldUpdate = attrs.shouldUpdate\n        vdom.unload = attrs.unload\n        vdom.config = attrs.config\n        vdom.__hash = hash(vdom)\n        delete attrs.unload\n        delete attrs.shouldUpdate\n        delete attrs.config\n        return vdom\n    }\n\n    // creatign html, strip events from DOM element... for now just deleting\n    const stripEvents = ({attrs}) => {\n        let a = Object.create(null)\n\n        if(attrs){\n            for(var name in attrs){\n                if(name[0]==='o'&&name[1]==='n') {\n                    a[name] = attrs[name]\n                    delete attrs[name]\n                }\n            }\n        }\n\n        return a\n    }\n\n    const applyEvents = (events, el, strip_existing=true) => {\n        strip_existing && removeEvents(el)\n        for(var name in events){\n            el[name] = events[name]\n        }\n    }\n\n    const flatten = (arr, a=[]) => {\n        for(var i=0,len=arr.length; i<len; i++){\n            let v = arr[i]\n            if(!(v instanceof Array)){\n                a.push(v)\n            } else {\n                flatten(v, a)\n            }\n        }\n        return a\n    }\n\n    const EVENTS = 'mouseover,mouseout,wheel,mousemove,blur,focus,click,abort,afterprint,animationend,animationiteration,animationstart,beforeprint,canplay,canplaythrough,change,contextmenu,dblclick,drag,dragend,dragenter,dragleave,dragover,dragstart,drop,durationchange,emptied,ended,error,load,input,invalid,keydown,keypress,keyup,loadeddata,loadedmetadata,mousedown,mouseenter,mouseleave,mouseup,pause,pointercancel,pointerdown,pointerenter,pointerleave,pointermove,pointerout,pointerover,pointerup,play,playing,ratechange,reset,resize,scroll,seeked,seeking,select,selectstart,selectionchange,show,submit,timeupdate,touchstart,touchend,touchcancel,touchmove,touchenter,touchleave,transitionend,volumechange,waiting'.split(',').map(x => 'on'+x)\n\n    const removeEvents = el => {\n        // strip away event handlers on el, if it exists\n        if(!el) return;\n        for(var i in EVENTS){\n            el[i] = null\n        }\n    }\n\n    let mnt\n\n    const mount = (fn, el) => {\n        mnt = [el, fn]\n        render(fn, el)\n    }\n\n    const render = debounce((fn, el) => rAF(_ => {\n        applyUpdates(fn, el.children[0], el)\n    }))\n\n    const update = () => {\n        if(!mnt) return\n        let [el, fn] = mnt\n        render(fn, el)\n    }\n\n    const stylify = style => {\n        let s = ''\n        for(var i in style){\n            s+=`${i}:${style[i]};`\n        }\n        return s\n    }\n\n    const setAttrs = ({attrs, id, className, __hash},el) => {\n    \tel.className = ''\n    \tel.style = ''\n\n        if(attrs){\n            for(var attr in attrs){\n                if(attr === 'style') {\n                    el.style = stylify(attrs[attr])\n                } else if(attr === 'innerHTML'){\n                    rAF(() => el.innerHTML = attrs[attr])\n                } else if(attr === 'value'){\n                    rAF(() => el.value = attrs[attr])\n                } else {\n                    el.setAttribute(attr, attrs[attr])\n                }\n            }\n        }\n        let _id = attrs.id || id\n        if(_id) el.id = _id\n        let _className = ((attrs.className || '') + ' ' + (className || '')).trim()\n        if(_className) el.className = _className\n        el.__hash = __hash\n    }\n\n    // recycle or create a new el\n    const createTag = (vdom=Object.create(null), el, parent=el&&el.parentElement) => {\n        let __vdom = vdom\n        // make text nodes from primitive types\n        if(typeof vdom !== 'object'){\n            let t = document.createTextNode(vdom)\n            if(el){\n                parent.insertBefore(t,el)\n                removeEl(el)\n            } else {\n                parent.appendChild(t)\n            }\n            return t\n        }\n\n        // else make an HTMLElement from \"tag\" types\n        let {tag, attrs, id, className, unload, shouldUpdate, config, __hash} = vdom,\n            shouldExchange = !el || !el.tagName || (tag && el.tagName.toLowerCase() !== tag.toLowerCase()),\n            _shouldUpdate = !(shouldUpdate instanceof Function) || shouldUpdate(el)\n\n        if(!attrs) return\n        if(el && (!_shouldUpdate || ((!vdom instanceof Function) && el.__hash === __hash))) {\n            return\n        }\n\n        if(shouldExchange){\n            let t = document.createElement(tag)\n            el ? (parent.insertBefore(t, el), removeEl(el)) : parent.appendChild(t)\n            el = t\n        }\n\n        setAttrs(vdom, el)\n        if(el.unload instanceof Function) {\n            rAF(el.unload)\n        }\n        if(unload instanceof Function) {\n            el.unload = unload\n        }\n        applyEvents(stripEvents(vdom), el)\n        config && rAF(_ => config(el))\n        return el\n    }\n\n    // find parent element, and remove the input element\n    const removeEl = el => {\n        if(!el) return\n        el.parentElement.removeChild(el)\n        removeEvents(el)\n        // removed for now, added unload logic to the immediate draw()s\n        if(el.unload instanceof Function)\n            el.unload()\n    }\n\n    const insertAt = (el, parent, i) => {\n        if(parent.children.length > i) {\n            let next_sib = parent.children[i]\n            parent.insertBefore(el, next_sib)\n        } else {\n            parent.appendChild(el)\n        }\n    }\n\n    const applyUpdates = (vdom, el, parent=el&&el.parentElement) => {\n        let v = vdom\n        // if vdom is a function, execute it until it isn't\n        while(vdom instanceof Function)\n            vdom = vdom()\n\n        if(!vdom) return\n\n        if(vdom.resolve instanceof Function){\n            let i = parent.children.length\n            return vdom.resolve().then(v => {\n                if(!el) {\n                    let x = createTag(v, null, parent)\n                    insertAt(x, parent, i)\n                    applyUpdates(v, x, parent)\n                } else {\n                    applyUpdates(v, el, parent)\n                }\n            })\n        }\n\n        // create/edit el under parent\n        let _el = vdom instanceof Array ? parent : createTag(vdom, el, parent)\n\n        if(!_el) return\n\n        if(vdom instanceof Array || vdom.children){\n            let vdom_children = flatten(vdom instanceof Array ? vdom : vdom.children),\n                el_children = vdom instanceof Array ? parent.childNodes : _el.childNodes\n\n            while(el_children.length > vdom_children.length){\n                removeEl(el_children[el_children.length-1])\n            }\n\n            for(let i=0; i<vdom_children.length; i++){\n                applyUpdates(vdom_children[i],el_children[i],_el)\n            }\n        } else {\n            while(_el.childNodes.length > 0){\n                removeEl(_el.childNodes[_el.childNodes.length-1])\n            }\n        }\n    }\n\n    const qs = (s='body', el=document) => el.querySelector(s)\n\n    const resolver  = (states = {}) => {\n        let promises = [],\n            done = false\n\n        const _await = (_promises = []) => {\n            promises = [...promises, ..._promises]\n            return finish()\n        }\n\n        const wait = (ms=0) => new Promise(res => setTimeout(res, ms))\n\n        const isDone = () => done\n\n        const finish = () => {\n            const total = promises.length\n            return wait().then(_ => Promise.all(promises)).then(values => {\n                if(promises.length > total){\n                    return finish()\n                }\n                done = true\n                return states\n            })\n        }\n\n        const resolve = (props) => {\n            const keys = Object.keys(props)\n            if (!keys.length)\n                return Promise.resolve(true)\n\n            let f = []\n            keys.forEach(name => {\n                let x = props[name]\n\n                while(x instanceof Function)\n                    x = x()\n\n                if(x && x.then instanceof Function)\n                    f.push(x.then(d => states[name] = d))\n            })\n\n            return _await(f)\n        }\n\n        const getState = () => states\n\n        return { finish, resolve, getState, promises, isDone }\n    }\n\n    const gs = (view, state) => {\n        let r = view(state)\n        while(r instanceof Function)\n            r = view(instance.getState())\n        return r\n    }\n\n    const container = (view, queries={}, instance=resolver()) => {\n        let wrapper_view = state =>\n            instance.isDone() ? view(state) : m('span')\n\n        return () => {\n            let r = gs(wrapper_view, instance.getState())\n            instance.resolve(queries)\n\n            if(r instanceof Array) {\n                let d = instance.finish().then(_ =>\n                    gs(wrapper_view, instance.getState()))\n\n                return r.map((x,i) => {\n                    x.resolve = _ => d.then(vdom => vdom[i])\n                    return x\n                })\n            }\n\n            r.resolve = _ => instance.finish().then(_ =>\n                gs(wrapper_view, instance.getState()))\n\n            return r\n        }\n    }\n\n    const reservedAttrs = ['className','id']\n\n    const toHTML = _vdom => {\n        while(_vdom instanceof Function) _vdom = _vdom()\n        if(_vdom instanceof Array) return new Promise(r => r(html(..._vdom)))\n        if(!_vdom) return new Promise(r => r(''))\n        if(typeof _vdom !== 'object') return new Promise(r => r(_vdom))\n        return (_vdom.resolve ? _vdom.resolve() : Promise.resolve()).then(vdom => {\n            if(!vdom) vdom = _vdom\n\n            if(vdom instanceof Array) return new Promise(r => r(html(...vdom)))\n\n            const {tag, id, className, attrs, children, instance} = vdom,\n                _id = (id || (attrs && attrs.id)) ? ` id=\"${(id || (attrs && attrs.id) || '')}\"` : '',\n                _class = (className || (attrs && attrs.className)) ? ` class=\"${((className||'') + ' ' + (attrs.className||'')).trim()}\"` : ''\n\n            const events = stripEvents(vdom)\n            let _attrs = '',\n                inner = ''\n            for(var i in (attrs || Object.create(null))){\n                if(i === 'style'){\n                    _attrs += ` style=\"${stylify(attrs[i])}\"`\n                } else if(i === 'innerHTML') {\n                    inner = attrs[i]\n                } else if(reservedAttrs.indexOf(i) === -1){\n                    _attrs += ` ${i}=\"${attrs[i]}\"`\n                }\n            }\n\n            if(!inner && children)\n                return html(...children).then(str =>\n                    `<${tag}${_id}${_class}${_attrs}>${str}</${tag}>`)\n\n            if('br,input,img'.split(',').filter(x => x===tag).length === 0)\n                return new Promise(r => r(`<${tag}${_id}${_class}${_attrs}>${inner}</${tag}>`))\n\n            return new Promise(r => r(`<${tag}${_id}${_class}${_attrs} />`))\n        })\n    }\n\n    const html = (...v) => Promise.all(v.map(toHTML)).then(x => x.filter(x => !!x).join(''))\n\n    return {container, html, qs, update, mount, m, debounce}\n}\n\nmodule.exports = vdom()\n\n/*\nusage:\n\nlet component = () =>\n    new Array(20).fill(true).map(x =>\n        m('div', {onMouseOver: e => log(e.target.innerHTML)}, range(1,100)))\n\nclient-side\n-----\nmount(component, qs())\n\nclient-side constant re-rendering\n-----\nconst run = () => {\n    setTimeout(run, 20)\n    update()\n}\nrun()\n*/\n\n/* CONTAINER / HTML USAGE (Server-side rendering)\n\nconst name = _ => new Promise(res => setTimeout(_ => res('matt'), 1500))\n\nlet x = container(data => [\n        m('div.test.row', {className:'hola', 'data-name':data.name, style:{border:'1px solid black'}}),\n        m('div', data.name),\n    ],\n    {name}\n)\n\nhtml(x).then(x => log(x)).catch(e => log(e+''))\n*/\n","\nconst mixin = (...classes) => {\n    class _mixin {}\n\n    let proto = _mixin.prototype\n\n    classes.map(({prototype:p}) => {\n        Object.getOwnPropertyNames(p).map(key => {\n            let oldFn = proto[key] || ($ => {})\n            proto[key] = function() {\n                oldFn.apply(null, [].slice.call(arguments))\n                return p[key].apply(null, [].slice.call(arguments))\n            }\n        })\n    })\n\n    return _mixin\n}\n\nmodule.exports = mixin","// Validate JS objects for their \"shape\"\nconst model = {\n    is(type, value) {\n        if(type && type.isValid instanceof Function){\n            return type.isValid(value)\n        } else if((type === String && ((value instanceof String) || typeof value === 'string'))\n            || (type === Number && ((value instanceof Number) || typeof value === 'number'))\n            || (type === Boolean && ((value instanceof Boolean) || typeof value === 'boolean'))\n            || (type === Function && ((value instanceof Function) || typeof value === 'function'))\n            || (type === Object && ((value instanceof Object) || typeof value === 'object'))\n            || (type === undefined)\n        ){\n            return true\n        }\n\n        return false\n    },\n    check(types, required, data) {\n        Object.keys(types).forEach(key => {\n            let t = types[key],\n                value = data[key]\n\n            if(required[key] || value !== undefined){\n                if(!(t instanceof Array)) t = [t]\n\n                let i = t.reduce((a,_type) => a || MODEL.is(_type, value), false)\n                if(!i) {\n                    throw `{${key}: ${JSON.stringify(value)}} is not one of ${t.map(x => `\\n - ${x}`)}`\n                }\n            }\n        })\n\n        return true\n    },\n    init(...args) {\n        let types, required, logic\n        args.map(x => {\n            if(x instanceof Function && !logic){ logic = x }\n            else if(typeof x === 'object') {\n                if(!types){ types = x }\n                else if(!required){ required = x }\n            }\n        })\n\n        const isValid = (data) => {\n            const pipe = logic ? [check, logic] : [check]\n            return pipe.reduce((a,v) => a && v(types||{},required||{},data), true)\n        }\n\n        const whenValid = (data) => new Promise((res,rej) => isValid(data) && res(data))\n\n        return {isValid, whenValid}\n    },\n    ArrayOf(M) {\n        return MODEL.init((t,r,data) => {\n            if(!(data instanceof Array)) throw `${data} not an Array`\n            data.map(x => {\n                if(!MODEL.is(M, x))\n                    throw `${x} is not a model instance`\n            })\n            return true\n        })\n    }\n}\n\nexport default model\n\n/**\nUse it\n\n// create a Name model with required first/last,\n// but optional middle\nlet Name = MODEL.init({\n    first: String,\n    middle: String,\n    last: String\n}, {first:true, last:true})\n\n// create a Tags model with extra checks\nlet Tags = MODEL.init((types,required,data) => {\n    if(!(data instanceof Array)) throw `${data} not an Array`\n    data.map(x => {\n        if(!is(String, x))\n            throw `[${data}] contains non-String`\n    })\n    return true\n})\n\n// create a Price model that just has a business logic fn\nlet Price = MODEL.init((t,r,d) => {\n    return (d instanceof Number || typeof d === 'number') && d !== 0\n})\n\n// create an Activity model with a required type and name,\n// all others optional\nlet Activity = MODEL.init({\n    type: [String, Function, Number],\n    latlng: Array,\n    title: String,\n    tags: Tags,\n    name: Name,\n    price: Price\n}, {name:true, price: true})\n\n// create a new Activity instance, throwing errors if there are\n// any invalid fields.\nlet a = {\n    tags: ['1','2'],\n    type: 1,\n    name: {first:'matt',last:'keas'},\n    price: 100.43,\n    url: 'http://www.google.com'\n}\nActivity.whenValid(a).then(log).catch(e => log(e+''))\n**/\n","// async-supporting-observables\nconst obs = (state) => {\n    let subscribers = []\n\n    const fn = (val) => {\n        if(val !== undefined){\n            state = val\n            for(let i = 0, len = subscribers.length; i<len; i++)\n            \tsubscribers[i](val)\n        }\n        return state\n    }\n\n    fn.map = f => {\n      const o = obs()\n      subscribers.push(val => o(f(val)))\n      return o\n    }\n\n    fn.filter = f => {\n      const o = obs()\n      subscribers.push(val => f(val) && o(val))\n      return o\n    }\n\n    fn.then = f => {\n      subscribers.push(val => f(val))\n      return fn\n    }\n\n    fn.take = (n) => {\n        const values = [],\n        \to = obs()\n\n        const cb = val => {\n            if(values.length < n)\n                values.push(val)\n\n            if(values.length === n) {\n                subscribers.delete(cb)\n                return o(values)\n            }\n        }\n\n        subscribers.push(cb)\n\n        return o\n    }\n\n    fn.takeWhile = f => {\n        const values = [],\n        \to = obs()\n\n        const cb = val => {\n            if(!f(val)) {\n                subscribers = subscribers.filter(x => x !== cb)\n                return o(values)\n            }\n\n\t\t\tvalues.push(val)\n        }\n\n        subscribers.push(cb)\n\n        return o\n    }\n\n    fn.reduce = (f,acc) => {\n        const o = obs()\n\n        subscribers.push(val => {\n            acc = f(acc,val)\n            o(acc)\n        })\n\n        return o\n    }\n\n    fn.maybe = f => {\n        const success = obs(),\n              error = obs(),\n              cb = val =>\n        \t\tf(val)\n\t\t\t\t    .then(d => success(d))\n                    .catch(e => error(e))\n\n        subscribers.push(cb)\n\n        return [ success, error ]\n    }\n\n    fn.stop = () => subscribers = []\n\n    fn.debounce = ms => {\n        const o = obs()\n        let ts = +new Date\n        subscribers.push(val => {\n            const now = +new Date\n            if(now - ts >= ms){\n                ts = +new Date\n                o(val)\n            }\n        })\n        return o\n    }\n\n    return fn\n}\n\nobs.from = f => {\n    const o = obs()\n    f(x => o(x))\n    return o\n}\n\nobs.union = (...fs) => {\n    const o = obs()\n    fs.map(f => f.then(o))\n    return o\n}\n\nexport default obs","// compute the hamming weight\nexport const hamming = x => {\n    x -= ((x >> 1) & 0x55555555)\n    x = (x & 0x33333333) + ((x >> 2) & 0x33333333)\n    x = (x + (x >> 4)) & 0x0f0f0f0f\n    x += (x >> 8)\n    x += (x >> 16)\n    return (x & 0x7f)\n}\n\nexport const popcount = root => {\n    if(root.key)\n        return 1\n\n    let c = root.children\n    if(c) {\n        var sum = 0\n        for(var i in c) sum += popcount(c[i])\n        return sum\n    }\n}\n\n// hash fn\nexport const hash = (v='') => {\n    v = JSON.stringify(v)\n    var hash = 5381\n    for (let i = 0; i < v.length; i++)\n        hash = ((hash << 5) + hash) + v.charCodeAt(i)\n    return hash\n}\n\n// compare two hashes\nexport const comp = (a,b) => hash(a) === hash(b)\n\n// get a bit vector\nexport const HMAP_SIZE = 8\nexport const MAX_DEPTH = 32 / HMAP_SIZE - 1\nexport const vec = (h=0, i=0, range=HMAP_SIZE) => (h >>> (range*i)) & ((1 << range) - 1)\n\nexport const shallowClone = x => {\n    let y = Object.create(null)\n    for(let i in x)\n        y[i] = x[i]\n    return y\n}\n\nexport const cloneNode = x => {\n    let y = node()\n    if(!x) return y\n\n    if(x.children) {\n        y.children = shallowClone(x.children)\n    } else if(x.key !== undefined) {\n        y.key = x.key\n        y.val = x.val\n        y.hash = x.hash\n    }\n\n    return y\n}\n\nexport const numChildren = x => {\n    let c = 0\n    for(var i in x) ++c\n    return c\n}\n\nexport const set = (root, key, val) => {\n    if((root.key === undefined) && !root.children) return node(key, val)\n\n    const newroot = cloneNode(root), h = hash(key)\n\n    // walk the tree\n    for(var i = 3, r = root, n = newroot; i >= 0; --i){\n        let bits = vec(h, i)\n\n        if(r.key !== undefined){\n            // if we have a collision\n            if(r.key === key || i === 0) {\n                // if keys match or is leaf, just overwrite n's val\n                n.val = val\n            } else if(i !== 0) {\n                // else if r is not at max depth and keys don't match\n                // add levels to both trees, new tree must be able\n                // to access old data\n\n                // 0. create makeshift value node for r\n                // and new value node for n\n                let cp = node(r.key, r.val, r.hash)\n                let cn = node(key, val, h)\n                let rh = r.hash\n\n                // 1. delete value props from nodes\n                delete r.key\n                delete r.val\n                delete r.hash\n                delete n.key\n                delete n.val\n                delete n.hash\n\n                // 2. create layers until bit-vectors don't collide\n                for(let j = i, __r = r, __n = n; j >= 0; j--){\n                    let vecr = vec(rh, j),\n                        vecn = vec(h, j)\n\n                    // create new layer for c and r\n                    let c = __r.children = Object.create(null)\n                    let d = __n.children = shallowClone(c)\n\n                    if(vecr !== vecn) {\n                        c[vecr] = cp\n                        d[vecr] = cp\n                        d[vecn] = cn\n                        break\n                    } else {\n                        __r = c[vecr] = node()\n                        __n = d[vecn] = cloneNode(__r)\n                    }\n                }\n            }\n            break\n        } else if(r.children) {\n            let _r = r.children[bits]\n            if(!_r) {\n                n = n.children[bits] = node(key, val)\n                break\n            } else {\n                r = _r\n                n = n.children[bits] = cloneNode(r)\n            }\n        }\n    }\n\n    return newroot\n}\n\nexport const get = (root, key) => {\n    if(root.key === key) return root.val\n    const h = hash(key)\n    for(let i = 3, r = root; i >= 0; --i){\n        if(!r.children) return undefined\n        r = r.children[vec(h, i)]\n        if(!r) return undefined\n        if(r.key !== undefined) return r.val\n    }\n\n    return undefined\n}\n\nexport const first = root => {\n    let c = root.children\n    for(let i in c) return c[i]\n}\n\nexport const unset = (root, key) => {\n    const n = cloneNode(root),\n          h = hash(key)\n\n    for(var i = 3, _n = n, p = n; i >= -1; --i) {\n        if(_n.key) {\n            delete _n.key\n            delete _n.val\n            delete _n.hash\n            return n\n\n//             let c = numChildren(p)\n\n//             if(c === 1) {\n//                 // if only child, delete child and parent?\n//                 delete p.children\n//             } else if(c===2){\n//                 // if 2 children, promote sibling as parent value nod\n//                 delete p.children[bits]\n//                 let sibling = first(p)\n//                 delete p.children\n//                 if(sibling.children){\n//                     p.children = sibling.children\n//                 } else if(p.key) {\n//                     p.val = sibling.val\n//                     p.hash = sibling.hash\n//                     p.key = sibling.key\n//                 }\n//             } else {\n//                 // if more than 2 children, just delete the one\n//                 delete p.children[bits]\n//             }\n//             return n\n        }\n\n        const bits = vec(h, i)\n        _n = _n && _n.children && _n.children[bits]\n        if(!_n) return n\n        p = _n\n    }\n    return n\n}\n\nexport const node = (key,val,h= key !== undefined && hash(key)) => {\n    /*\n    potential props of a tree node\n    - key - hashkey\n    - val - value\n    - children - { ... } -> points to other nodes (List<Node> children)\n    */\n\n    let item = Object.create(null)\n    if(key !== undefined){\n        item.key = key\n        item.hash = h\n        item.val = val\n    }\n    return item\n}\n\nexport const map = (root, fn) => {\n    if(root.key !== undefined)\n        return node(root.key, fn(root.val, root.key), root.hash)\n\n    let d = cloneNode(root),\n        c = d.children\n\n    if(c) {\n        for(var i in c){\n            c[i] = map(c[i], fn)\n        }\n    }\n\n    return d\n}\n\nexport const filter = (root, fn) => {\n    if(root.key !== undefined)\n        return fn(root.val, root.key) ? root : undefined\n\n    let d = cloneNode(root),\n        c = d.children\n\n    if(c) {\n        for(var i in c){\n            if(!filter(c[i], fn))\n                delete c[i]\n        }\n    }\n\n    return d\n}\n\nexport const reduce = (root, fn, acc) => {\n    if(root.key !== undefined)\n        return fn(acc, root.val, root.key)\n\n    let c = root.children\n    if(c) {\n        for(var i in c)\n            acc = reduce(c[i], fn, acc)\n\n        return acc\n    }\n}\n\nexport const toList = (root, r=[]) => {\n    if(root.key !== undefined) r.push(root.val)\n\n    let c = root.children\n    if(c) {\n        for(var i in c) {\n            toList(c[i], r)\n        }\n    }\n\n    return r\n}\n\nexport const toOrderedList = (root, r=[]) => {\n    let i = 0,\n        n\n\n    do {\n        n = get(root, i++)\n        n !== undefined && r.push(n)\n    } while(n)\n\n    return r\n}\n\nexport const toJSON = (root, r={}) => {\n    if(root.key !== undefined)\n        r[root.key] = root.val\n\n    let c = root.children\n    if(c) {\n        for(var i in c) {\n            toJson(c[i], r)\n        }\n    }\n\n    return r\n}\n\nexport const push = (root, val) => set(root, popcount(root), val)\n\nexport const pop = root => unset(root, popcount(root)-1)\n\nexport const shift = root => reduce(\n    unset(root, 0),\n    (acc,v,k) => set(acc, k-1, v),\n    node())\n\nexport const unshift = (root, val) =>\n    set(\n        reduce(\n            root,\n            (acc,v,k) => set(acc, k+1, v),\n            node()),\n        0,\n        val)\n\nexport const hamt = node\n\n// console.clear()\n// const l = (...args) => console.log(...args)\n// const j = (...a) => console.log(JSON.stringify(a))\n\n// let x = hamt()\n// let s = 20\n\n// Array(s).fill(1).map((v,i) => {\n//     x = set(x, i, i)\n// })\n\n// l(toList(x))\n// l(toJson(x))\n\n// x = map(x, x => log(x*x) || x*x)\n// l(get(x, 19))\n\n// l(x)\n// l(reduce(x, (acc, x) => acc+x, 0))\n\n// x = unset(x, 1)\n// Array(s).fill(1).map((_,i) => {\n//     if(!get(x, i)) l(i)\n//     // l(get(x, i))\n// })","const supports = (...q) => () =>\n    q.reduce((acc,s) =>\n        acc\n        || (window[s] !== undefined)\n        && /[native code]/.test(window[s]+'')\n        && window[s]\n    , false)\n\nconst supportsWorkers = supports('Worker')\n\nconst supportsBlobs = supports('Blob')\n\nconst supportsURLs = supports('URL', 'webkitURL')\n\nconst supportsBuilders = supports('BlobBuilder', 'WebKitBlobBuilder', 'MozBlobBuilder')\n\n/*\nworker:: [X] -> Worker where X : Function | String\n\nthe last X provided in the arguments will be setup as the handler for self.onmessage()\n*/\nexport const worker = (...code) => {\n    if(!supportsWorkers()) throw 'WebWorkers not supported'\n\n    code[code.length-1] = `self.onmessage=${code[code.length-1]}`\n\n    const B = supportsBlobs()\n        , U = supportsBuilders()\n        , W = supportsURLs()\n\n    let blob\n\n    if(supportsBlobs()) {\n        blob =\n            new B(code.map(c => c+''),\n            {type: 'application/javascript'})\n\n    } else if(U){\n        blob = new U\n        code.map(c => blob.append(c+''))\n        blob = blob.getBlob()\n    } else {\n        blob = `data:application/javascript,`\n            +`${encodeURIComponent(\n                code.reduce((acc,c) => acc+c, '')\n              )}`\n    }\n\n    let url = W.createObjectURL(blob)\n    return new Worker(url)\n}\n\nexport const farm = (n, ...code) => {\n    let workers = Array(n).fill(1).map(x => worker(...code))\n        , current = 0\n        , iter = () => {\n            let _n = current\n            ++current >= n && (current = 0)\n            return current\n        }\n        , pipe\n        , onerror\n\n    workers.map(w => {\n        w.onmessage = e => pipe instanceof Function && pipe(e.data)\n        w.onerror = e => onerror instanceof Function && onerror(e)\n    })\n\n    const exec = (...args) => {\n        let w = workers[iter()]\n        w && w.postMessage(args)\n    }\n\n    exec.pipe = fn => {\n        pipe = fn\n        return exec\n    }\n    exec.error = fn => {\n        onerror = fn\n        return exec\n    }\n    return exec\n}\n","export const log = (...a) => console.log(...a)\n\n// rAF\nexport const rAF =\n      typeof document !== 'undefined' &&\n      (requestAnimationFrame ||\n      webkitRequestAnimationFrame ||\n      mozRequestAnimationFrame) ||\n      process && process.nextTick ||\n      (cb => setTimeout(cb, 16.6))\n\n// composition\n// c :: (T -> U) -> (U -> V) -> (T -> V)\nexport const c = (f,g) => x => f(g(x))\n\n// cof :: [(an -> bn)] -> a0 -> bn\n// compose forward\nexport const cof = (...fns) => fns.reduce((acc,fn) => c(acc, fn))\n\n// cob :: [(an -> bn)] -> b0 -> an\n// compose backwards\nexport const cob = (...fns) => cof(...fns.reverse())\n\n// functional utilities\n// pointfree\nexport const pf = fn => (...args) => x => fn.apply(x, args)\n\n// curry\n// curry :: (T -> U) -> [args] -> ( -> U)\nexport const curry = (fn, ...args) =>\n\tfn.bind(undefined, ...args)\n\n\n// Transducers\nexport const mapping = (mapper) => // mapper: x -> y\n    (reducer) => // reducer: (state, value) -> new state\n        (result, value) =>\n            reducer(result, mapper(value))\n\nexport const filtering = (predicate) => // predicate: x -> true/false\n    (reducer) => // reducer: (state, value) -> new state\n        (result, value) =>\n            predicate(value) ? reducer(result, value) : result\n\nexport const concatter = (thing, value) =>\n    thing.concat([value])\n"]}