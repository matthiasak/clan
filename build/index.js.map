{"version":3,"sources":["index.js","batch.js","vdom.js","fp.js","mixin.js","model.js","observable.js","hamt.js","worker.js"],"names":["hamt","worker","fp","hash","v","_v","JSON","stringify","i","len","length","c","charCodeAt","module","exports","Object","assign","batch","vdom","mixin","model","obs","inflight","url","options","method","key","toLowerCase","f","compress","Promise","res","rej","then","d","catch","e","undefined","data","console","error","class_id_regex","tagName_regex","parseSelector","test","tagreg","exec","s","tag","slice","reg","create","substr","className","trim","id","debounce","func","wait","immediate","timeout","args","later","callNow","clearTimeout","setTimeout","m","selector","children","attrs","Array","Function","unshift","shouldUpdate","unload","config","__hash","stripEvents","a","name","applyEvents","events","el","strip_existing","removeEvents","flatten","arr","push","EVENTS","split","map","x","mnt","mount","fn","render","applyUpdates","update","stylify","style","setAttrs","attr","innerHTML","value","setAttribute","_id","_className","createTag","parent","parentElement","__vdom","t","document","createTextNode","insertBefore","removeEl","appendChild","shouldExchange","tagName","_shouldUpdate","createElement","removeChild","insertAt","next_sib","resolve","_el","vdom_children","el_children","childNodes","qs","querySelector","resolver","states","promises","done","_await","_promises","finish","ms","isDone","total","all","props","keys","forEach","getState","gs","view","state","r","instance","container","queries","wrapper_view","reservedAttrs","toHTML","_vdom","html","_class","_attrs","inner","indexOf","str","filter","join","log","rAF","global","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","cb","g","cof","fns","reduce","acc","cob","reverse","pf","apply","curry","bind","mapping","mapper","reducer","result","filtering","predicate","concatter","thing","concat","classes","_mixin","proto","prototype","p","getOwnPropertyNames","oldFn","call","arguments","is","type","isValid","String","Number","Boolean","check","types","required","_type","MODEL","init","logic","pipe","whenValid","ArrayOf","M","subscribers","val","o","take","n","values","delete","takeWhile","maybe","success","stop","ts","Date","now","from","union","fs","hamming","popcount","root","sum","comp","b","HMAP_SIZE","MAX_DEPTH","vec","h","range","shallowClone","y","cloneNode","node","numChildren","set","newroot","bits","cp","cn","rh","j","__r","__n","vecr","vecn","_r","get","first","unset","_n","item","toList","toOrderedList","toJSON","toJson","pop","shift","k","supports","q","window","supportsWorkers","supportsBlobs","supportsURLs","supportsBuilders","code","B","U","W","blob","append","getBlob","encodeURIComponent","createObjectURL","Worker","farm","workers","fill","current","iter","onerror","w","onmessage","postMessage"],"mappings":";;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;IAAYA;;AACZ;;IAAYC;;AACZ;;IAAYC;;;;;;AAEL,IAAMC,sBAAO,cAACC,CAAD,EAA4B;AAAA,QAAzBC,EAAyB,uEAAtBC,KAAKC,SAAL,CAAeH,CAAf,CAAsB;;AAC5C,QAAID,OAAO,CAAX;AACA,SAAK,IAAIK,IAAI,CAAR,EAAWC,MAAMJ,GAAGK,MAAzB,EAAiCF,IAAIC,GAArC,EAA0C,EAAED,CAA5C,EAA+C;AAC3C,YAAMG,IAAIN,GAAGO,UAAH,CAAcJ,CAAd,CAAV;AACAL,eAAS,CAACA,QAAQ,CAAT,IAAcA,IAAf,GAAuBQ,CAAxB,GAA6B,CAApC;AACH;AACD,WAAOR,IAAP;AACH,CAPM;;AASPU,OAAOC,OAAP,GAAiBC,OAAOC,MAAP,CAAc,EAAd,EAAkBd,EAAlB,EAAsB;AACtCe,0BADsC;AAEpCC,wBAFoC;AAGpCC,0BAHoC;AAIpCC,0BAJoC;AAKpCC,6BALoC;AAMpCrB,cANoC;AAOpCC;AAPoC,CAAtB,CAAjB;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;;AAEA;AACA,IAAMgB,QAAQ,SAARA,KAAQ,IAAK;AACf,QAAIK,WAAW,EAAf;;AAEA,WAAO,UAACC,GAAD,EAAqB;AAAA,YAAfC,OAAe,uEAAP,EAAO;AACpB,YAACC,MAAD,GAAWD,OAAX,CAACC,MAAD;AAAA,YACAC,GADA,GACSH,GADT,SACgBjB,KAAKC,SAAL,CAAeiB,OAAf,CADhB;;;AAGJ,YAAG,CAACC,UAAU,EAAX,EAAeE,WAAf,OAAiC,MAApC,EACI,OAAOC,EAAEL,GAAF,EAAOR,OAAOC,MAAP,CAAc,EAAd,EAAkBQ,OAAlB,EAA2B,EAACK,UAAU,KAAX,EAA3B,CAAP,CAAP;;AAEJ,eAAOP,SAASI,GAAT,MACFJ,SAASI,GAAT,IACG,IAAII,OAAJ,CAAY,UAACC,GAAD,EAAKC,GAAL,EAAa;AACrBJ,cAAEL,GAAF,EAAOR,OAAOC,MAAP,CAAc,EAAd,EAAkBQ,OAAlB,EAA2B,EAACK,UAAU,KAAX,EAA3B,CAAP,EACCI,IADD,CACM;AAAA,uBAAKF,IAAIG,CAAJ,CAAL;AAAA,aADN,EAECC,KAFD,CAEO;AAAA,uBAAKH,IAAII,CAAJ,CAAL;AAAA,aAFP;AAGH,SAJD,EAKCH,IALD,CAKM,gBAAQ;AACVX,uBAAWP,OAAOC,MAAP,CAAc,EAAd,EAAkBM,QAAlB,sBAA8BI,GAA9B,EAAoCW,SAApC,EAAX;AACA,mBAAOC,IAAP;AACH,SARD,EASCH,KATD,CASO;AAAA,mBACHI,QAAQC,KAAR,CAAcJ,CAAd,EAAiBb,GAAjB,CADG;AAAA,SATP,CAFD,CAAP;AAaH,KApBD;AAqBH,CAxBD;;kBA0BeN;;;;;;;;;;ACjCf;;;;AAEA;AACA,IAAMC,OAAO,gBAAM;AACf,QAAMuB,iBAAiB,SAAjBA,cAAiB,GAAM;AACrB,eAAO;AAAP;AACH,KAFL;AAAA,QAGIC,gBAAgB,SAAhBA,aAAgB,GAAM;AAClB,eAAO;AAAP;AACH,KALL;;AAOA,QAAMC,gBAAgB,SAAhBA,aAAgB,IAAK;AACvB,YAAIC,OAAO,IAAX;AAAA,YACIC,SAASH,gBAAgBI,IAAhB,CAAqBC,CAArB,CADb;AAAA,YAEIC,MAAMH,UAAUA,OAAOI,KAAP,CAAa,CAAb,EAAgB,CAAhB,CAFpB;AAAA,YAGIC,MAAMT,gBAHV;AAAA,YAIIvB,OAAOH,OAAOoC,MAAP,CAAc,IAAd,CAJX;;AAMA,YAAGH,GAAH,EAAQD,IAAIA,EAAEK,MAAF,CAASJ,IAAItC,MAAb,CAAJ;AACRQ,aAAKmC,SAAL,GAAiB,EAAjB;AACAnC,aAAK8B,GAAL,GAAWA,OAAO,KAAlB;;AAEA,eAAM,CAACJ,OAAOM,IAAIJ,IAAJ,CAASC,CAAT,CAAR,MAAyB,IAA/B,EAAoC;AAChCH,mBAAOA,KAAK,CAAL,CAAP;AACA,gBAAGA,KAAK,CAAL,MAAY,GAAf,EACI1B,KAAKmC,SAAL,GAAiB,CAACnC,KAAKmC,SAAL,GAAe,GAAf,GAAmBT,KAAKQ,MAAL,CAAY,CAAZ,CAApB,EAAoCE,IAApC,EAAjB,CADJ,KAEK,IAAGV,KAAK,CAAL,MAAY,GAAf,EACD1B,KAAKqC,EAAL,GAAUX,KAAKQ,MAAL,CAAY,CAAZ,CAAV;AACP;AACD,eAAOlC,IAAP;AACH,KAnBD;;AAqBA,QAAMsC,WAAW,SAAXA,QAAW,CAACC,IAAD,EAAOC,IAAP,EAAaC,SAAb,EAAwBC,OAAxB;AAAA,eACb,YAAa;AAAA,8CAATC,IAAS;AAATA,oBAAS;AAAA;;AACT,gBAAIC,QAAQ,SAARA,KAAQ,GAAM;AACdF,0BAAU,IAAV;AACA,iBAACD,SAAD,IAAcF,sBAAQI,IAAR,CAAd;AACH,aAHD;AAIA,gBAAIE,UAAUJ,aAAa,CAACC,OAA5B;AACAI,yBAAaJ,OAAb;AACAA,sBAAUK,WAAWH,KAAX,EAAkBJ,QAAQ,CAA1B,CAAV;AACAK,uBAAWN,sBAAQI,IAAR,CAAX;AACH,SAVY;AAAA,KAAjB;;AAYA,QAAM1D,OAAO,cAACC,CAAD,EAA4B;AAAA,YAAzBC,EAAyB,uEAAtBC,KAAKC,SAAL,CAAeH,CAAf,CAAsB;;AACrC,YAAID,OAAO,CAAX;AACA,aAAK,IAAIK,IAAI,CAAR,EAAWC,MAAMJ,GAAGK,MAAzB,EAAiCF,IAAIC,GAArC,EAA0C,EAAED,CAA5C,EAA+C;AAC3C,gBAAMG,IAAIN,GAAGO,UAAH,CAAcJ,CAAd,CAAV;AACAL,mBAAS,CAACA,QAAQ,CAAT,IAAcA,IAAf,GAAuBQ,CAAxB,GAA6B,CAApC;AACH;AACD,eAAOR,IAAP;AACH,KAPD;;AASA,QAAM+D,IAAI,SAAJA,CAAI,CAACC,QAAD,EAAsD;AAAA,2CAAbC,QAAa;AAAbA,oBAAa;AAAA;;AAAA,YAA3CC,KAA2C,uEAArCtD,OAAOoC,MAAP,CAAc,IAAd,CAAqC;;AAC5D,YAAGkB,MAAMrB,GAAN,IAAa,EAAE,QAAOqB,KAAP,yCAAOA,KAAP,OAAiB,QAAnB,CAAb,IAA6CA,iBAAiBC,KAA9D,IAAuED,iBAAiBE,QAA3F,EAAoG;AAChG,gBAAGF,iBAAiBC,KAApB,EAA2BF,SAASI,OAAT,oCAAoBH,KAApB,GAA3B,KACKD,SAASI,OAAT,CAAiBH,KAAjB;AACLA,oBAAQtD,OAAOoC,MAAP,CAAc,IAAd,CAAR;AACH;AACD,YAAIjC,OAAOyB,cAAcwB,QAAd,CAAX;AACA,YAAGC,SAAS1D,MAAZ,EACIQ,KAAKkD,QAAL,GAAgBA,QAAhB;AACJlD,aAAKmD,KAAL,GAAaA,KAAb;AACAnD,aAAKuD,YAAL,GAAoBJ,MAAMI,YAA1B;AACAvD,aAAKwD,MAAL,GAAcL,MAAMK,MAApB;AACAxD,aAAKyD,MAAL,GAAcN,MAAMM,MAApB;AACAzD,aAAK0D,MAAL,GAAczE,KAAKe,IAAL,CAAd;AACA,eAAOmD,MAAMK,MAAb;AACA,eAAOL,MAAMI,YAAb;AACA,eAAOJ,MAAMM,MAAb;AACA,eAAOzD,IAAP;AACH,KAlBD;;AAoBA;AACA,QAAM2D,cAAc,SAAdA,WAAc,OAAa;AAAA,YAAXR,KAAW,QAAXA,KAAW;;AAC7B,YAAIS,IAAI/D,OAAOoC,MAAP,CAAc,IAAd,CAAR;;AAEA,YAAGkB,KAAH,EAAS;AACL,iBAAI,IAAIU,IAAR,IAAgBV,KAAhB,EAAsB;AAClB,oBAAGU,KAAK,CAAL,MAAU,GAAV,IAAeA,KAAK,CAAL,MAAU,GAA5B,EAAiC;AAC7BD,sBAAEC,IAAF,IAAUV,MAAMU,IAAN,CAAV;AACA,2BAAOV,MAAMU,IAAN,CAAP;AACH;AACJ;AACJ;;AAED,eAAOD,CAAP;AACH,KAbD;;AAeA,QAAME,cAAc,SAAdA,WAAc,CAACC,MAAD,EAASC,EAAT,EAAqC;AAAA,YAAxBC,cAAwB,uEAAT,IAAS;;AACrDA,0BAAkBC,aAAaF,EAAb,CAAlB;AACA,aAAI,IAAIH,IAAR,IAAgBE,MAAhB,EAAuB;AACnBC,eAAGH,IAAH,IAAWE,OAAOF,IAAP,CAAX;AACH;AACJ,KALD;;AAOA,QAAMM,UAAU,SAAVA,OAAU,CAACC,GAAD,EAAe;AAAA,YAATR,CAAS,uEAAP,EAAO;;AAC3B,aAAI,IAAItE,IAAE,CAAN,EAAQC,MAAI6E,IAAI5E,MAApB,EAA4BF,IAAEC,GAA9B,EAAmCD,GAAnC,EAAuC;AACnC,gBAAIJ,IAAIkF,IAAI9E,CAAJ,CAAR;AACA,gBAAG,EAAEJ,aAAakE,KAAf,CAAH,EAAyB;AACrBQ,kBAAES,IAAF,CAAOnF,CAAP;AACH,aAFD,MAEO;AACHiF,wBAAQjF,CAAR,EAAW0E,CAAX;AACH;AACJ;AACD,eAAOA,CAAP;AACH,KAVD;;AAYA,QAAMU,SAAS,4rBAA4rBC,KAA5rB,CAAksB,GAAlsB,EAAusBC,GAAvsB,CAA2sB;AAAA,eAAK,OAAKC,CAAV;AAAA,KAA3sB,CAAf;;AAEA,QAAMP,eAAe,SAAfA,YAAe,KAAM;AACvB;AACA,YAAG,CAACF,EAAJ,EAAQ;AACR,aAAI,IAAI1E,CAAR,IAAagF,MAAb,EAAoB;AAChBN,eAAG1E,CAAH,IAAQ,IAAR;AACH;AACJ,KAND;;AAQA,QAAIoF,YAAJ;;AAEA,QAAMC,QAAQ,SAARA,KAAQ,CAACC,EAAD,EAAKZ,EAAL,EAAY;AACtBU,cAAM,CAACV,EAAD,EAAKY,EAAL,CAAN;AACAC,eAAOD,EAAP,EAAWZ,EAAX;AACH,KAHD;;AAKA,QAAMa,SAASvC,SAAS,UAACsC,EAAD,EAAKZ,EAAL;AAAA,eAAY,aAAI,aAAK;AACzCc,yBAAaF,EAAb,EAAiBZ,GAAGd,QAAH,CAAY,CAAZ,CAAjB,EAAiCc,EAAjC;AACH,SAFmC,CAAZ;AAAA,KAAT,CAAf;;AAIA,QAAMe,SAAS,SAATA,MAAS,GAAM;AACjB,YAAG,CAACL,GAAJ,EAAS;;AADQ,mBAEFA,GAFE;AAAA;AAAA,YAEZV,EAFY;AAAA,YAERY,EAFQ;;AAGjBC,eAAOD,EAAP,EAAWZ,EAAX;AACH,KAJD;;AAMA,QAAMgB,UAAU,SAAVA,OAAU,QAAS;AACrB,YAAInD,IAAI,EAAR;AACA,aAAI,IAAIvC,CAAR,IAAa2F,KAAb,EAAmB;AACfpD,iBAAMvC,CAAN,SAAW2F,MAAM3F,CAAN,CAAX;AACH;AACD,eAAOuC,CAAP;AACH,KAND;;AAQA,QAAMqD,WAAW,SAAXA,QAAW,QAAgClB,EAAhC,EAAuC;AAAA,YAArCb,KAAqC,SAArCA,KAAqC;AAAA,YAA9Bd,EAA8B,SAA9BA,EAA8B;AAAA,YAA1BF,SAA0B,SAA1BA,SAA0B;AAAA,YAAfuB,MAAe,SAAfA,MAAe;;AACvDM,WAAG7B,SAAH,GAAe,EAAf;AACA6B,WAAGiB,KAAH,GAAW,EAAX;;AAEG,YAAG9B,KAAH,EAAS;AACL,iBAAI,IAAIgC,IAAR,IAAgBhC,KAAhB,EAAsB;AAClB,oBAAGgC,SAAS,OAAZ,EAAqB;AACjBnB,uBAAGiB,KAAH,GAAWD,QAAQ7B,MAAMgC,IAAN,CAAR,CAAX;AACH,iBAFD,MAEO,IAAGA,SAAS,WAAZ,EAAwB;AAC3B,iCAAI;AAAA,+BAAMnB,GAAGoB,SAAH,GAAejC,MAAMgC,IAAN,CAArB;AAAA,qBAAJ;AACH,iBAFM,MAEA,IAAGA,SAAS,OAAZ,EAAoB;AACvB,iCAAI;AAAA,+BAAMnB,GAAGqB,KAAH,GAAWlC,MAAMgC,IAAN,CAAjB;AAAA,qBAAJ;AACH,iBAFM,MAEA;AACHnB,uBAAGsB,YAAH,CAAgBH,IAAhB,EAAsBhC,MAAMgC,IAAN,CAAtB;AACH;AACJ;AACJ;AACD,YAAII,MAAMpC,MAAMd,EAAN,IAAYA,EAAtB;AACA,YAAGkD,GAAH,EAAQvB,GAAG3B,EAAH,GAAQkD,GAAR;AACR,YAAIC,aAAa,CAAC,CAACrC,MAAMhB,SAAN,IAAmB,EAApB,IAA0B,GAA1B,IAAiCA,aAAa,EAA9C,CAAD,EAAoDC,IAApD,EAAjB;AACA,YAAGoD,UAAH,EAAexB,GAAG7B,SAAH,GAAeqD,UAAf;AACfxB,WAAGN,MAAH,GAAYA,MAAZ;AACH,KAtBD;;AAwBA;AACA,QAAM+B,YAAY,SAAZA,SAAY,GAA+D;AAAA,YAA9DzF,IAA8D,uEAAzDH,OAAOoC,MAAP,CAAc,IAAd,CAAyD;AAAA,YAApC+B,EAAoC;AAAA,YAAhC0B,MAAgC,uEAAzB1B,MAAIA,GAAG2B,aAAkB;;AAC7E,YAAIC,SAAS5F,IAAb;AACA;AACA,YAAG,QAAOA,IAAP,yCAAOA,IAAP,OAAgB,QAAnB,EAA4B;AACxB,gBAAI6F,IAAIC,SAASC,cAAT,CAAwB/F,IAAxB,CAAR;AACA,gBAAGgE,EAAH,EAAM;AACF0B,uBAAOM,YAAP,CAAoBH,CAApB,EAAsB7B,EAAtB;AACAiC,yBAASjC,EAAT;AACH,aAHD,MAGO;AACH0B,uBAAOQ,WAAP,CAAmBL,CAAnB;AACH;AACD,mBAAOA,CAAP;AACH;;AAED;;AAd6E,YAexE/D,GAfwE,GAeL9B,IAfK,CAexE8B,GAfwE;AAAA,YAenEqB,KAfmE,GAeLnD,IAfK,CAenEmD,KAfmE;AAAA,YAe5Dd,EAf4D,GAeLrC,IAfK,CAe5DqC,EAf4D;AAAA,YAexDF,SAfwD,GAeLnC,IAfK,CAexDmC,SAfwD;AAAA,YAe7CqB,MAf6C,GAeLxD,IAfK,CAe7CwD,MAf6C;AAAA,YAerCD,YAfqC,GAeLvD,IAfK,CAerCuD,YAfqC;AAAA,YAevBE,MAfuB,GAeLzD,IAfK,CAevByD,MAfuB;AAAA,YAefC,MAfe,GAeL1D,IAfK,CAef0D,MAfe;AAAA,YAgBzEyC,cAhByE,GAgBxD,CAACnC,EAAD,IAAO,CAACA,GAAGoC,OAAX,IAAuBtE,OAAOkC,GAAGoC,OAAH,CAAW3F,WAAX,OAA6BqB,IAAIrB,WAAJ,EAhBH;AAAA,YAiBzE4F,aAjByE,GAiBzD,EAAE9C,wBAAwBF,QAA1B,KAAuCE,aAAaS,EAAb,CAjBkB;;AAmB7E,YAAG,CAACb,KAAJ,EAAW;AACX,YAAGa,OAAO,CAACqC,aAAD,IAAoB,CAACrG,IAAD,YAAiBqD,QAAlB,IAA+BW,GAAGN,MAAH,KAAcA,MAAvE,CAAH,EAAoF;AAChF;AACH;;AAED,YAAGyC,cAAH,EAAkB;AACd,gBAAIN,KAAIC,SAASQ,aAAT,CAAuBxE,GAAvB,CAAR;AACAkC,kBAAM0B,OAAOM,YAAP,CAAoBH,EAApB,EAAuB7B,EAAvB,GAA4BiC,SAASjC,EAAT,CAAlC,IAAkD0B,OAAOQ,WAAP,CAAmBL,EAAnB,CAAlD;AACA7B,iBAAK6B,EAAL;AACH;;AAEDX,iBAASlF,IAAT,EAAegE,EAAf;AACA,YAAGA,GAAGR,MAAH,YAAqBH,QAAxB,EAAkC;AAC9B,yBAAIW,GAAGR,MAAP;AACH;AACD,YAAGA,kBAAkBH,QAArB,EAA+B;AAC3BW,eAAGR,MAAH,GAAYA,MAAZ;AACH;AACDM,oBAAYH,YAAY3D,IAAZ,CAAZ,EAA+BgE,EAA/B;AACAP,kBAAU,aAAI;AAAA,mBAAKA,OAAOO,EAAP,CAAL;AAAA,SAAJ,CAAV;AACA,eAAOA,EAAP;AACH,KAxCD;;AA0CA;AACA,QAAMiC,WAAW,SAAXA,QAAW,KAAM;AACnB,YAAG,CAACjC,EAAJ,EAAQ;AACRA,WAAG2B,aAAH,CAAiBY,WAAjB,CAA6BvC,EAA7B;AACAE,qBAAaF,EAAb;AACA;AACA,YAAGA,GAAGR,MAAH,YAAqBH,QAAxB,EACIW,GAAGR,MAAH;AACP,KAPD;;AASA,QAAMgD,WAAW,SAAXA,QAAW,CAACxC,EAAD,EAAK0B,MAAL,EAAapG,CAAb,EAAmB;AAChC,YAAGoG,OAAOxC,QAAP,CAAgB1D,MAAhB,GAAyBF,CAA5B,EAA+B;AAC3B,gBAAImH,WAAWf,OAAOxC,QAAP,CAAgB5D,CAAhB,CAAf;AACAoG,mBAAOM,YAAP,CAAoBhC,EAApB,EAAwByC,QAAxB;AACH,SAHD,MAGO;AACHf,mBAAOQ,WAAP,CAAmBlC,EAAnB;AACH;AACJ,KAPD;;AASA,QAAMc,eAAe,SAAfA,YAAe,CAAC9E,IAAD,EAAOgE,EAAP,EAA2C;AAAA,YAAhC0B,MAAgC,uEAAzB1B,MAAIA,GAAG2B,aAAkB;;AAC5D,YAAIzG,IAAIc,IAAR;AACA;AACA,eAAMA,gBAAgBqD,QAAtB;AACIrD,mBAAOA,MAAP;AADJ,SAGA,IAAG,CAACA,IAAJ,EAAU;;AAEV,YAAGA,KAAK0G,OAAL,YAAwBrD,QAA3B,EAAoC;AAAA;AAChC,oBAAI/D,IAAIoG,OAAOxC,QAAP,CAAgB1D,MAAxB;AACA;AAAA,uBAAOQ,KAAK0G,OAAL,GAAe3F,IAAf,CAAoB,aAAK;AAC5B,4BAAG,CAACiD,EAAJ,EAAQ;AACJ,gCAAIS,IAAIgB,UAAUvG,CAAV,EAAa,IAAb,EAAmBwG,MAAnB,CAAR;AACAc,qCAAS/B,CAAT,EAAYiB,MAAZ,EAAoBpG,CAApB;AACAwF,yCAAa5F,CAAb,EAAgBuF,CAAhB,EAAmBiB,MAAnB;AACH,yBAJD,MAIO;AACHZ,yCAAa5F,CAAb,EAAgB8E,EAAhB,EAAoB0B,MAApB;AACH;AACJ,qBARM;AAAP;AAFgC;;AAAA;AAWnC;;AAED;AACA,YAAIiB,MAAM3G,gBAAgBoD,KAAhB,GAAwBsC,MAAxB,GAAiCD,UAAUzF,IAAV,EAAgBgE,EAAhB,EAAoB0B,MAApB,CAA3C;;AAEA,YAAG,CAACiB,GAAJ,EAAS;;AAET,YAAG3G,gBAAgBoD,KAAhB,IAAyBpD,KAAKkD,QAAjC,EAA0C;AACtC,gBAAI0D,gBAAgBzC,QAAQnE,gBAAgBoD,KAAhB,GAAwBpD,IAAxB,GAA+BA,KAAKkD,QAA5C,CAApB;AAAA,gBACI2D,cAAc7G,gBAAgBoD,KAAhB,GAAwBsC,OAAOoB,UAA/B,GAA4CH,IAAIG,UADlE;;AAGA,mBAAMD,YAAYrH,MAAZ,GAAqBoH,cAAcpH,MAAzC,EAAgD;AAC5CyG,yBAASY,YAAYA,YAAYrH,MAAZ,GAAmB,CAA/B,CAAT;AACH;;AAED,iBAAI,IAAIF,IAAE,CAAV,EAAaA,IAAEsH,cAAcpH,MAA7B,EAAqCF,GAArC,EAAyC;AACrCwF,6BAAa8B,cAActH,CAAd,CAAb,EAA8BuH,YAAYvH,CAAZ,CAA9B,EAA6CqH,GAA7C;AACH;AACJ,SAXD,MAWO;AACH,mBAAMA,IAAIG,UAAJ,CAAetH,MAAf,GAAwB,CAA9B,EAAgC;AAC5ByG,yBAASU,IAAIG,UAAJ,CAAeH,IAAIG,UAAJ,CAAetH,MAAf,GAAsB,CAArC,CAAT;AACH;AACJ;AACJ,KA1CD;;AA4CA,QAAMuH,KAAK,SAALA,EAAK;AAAA,YAAClF,CAAD,uEAAG,MAAH;AAAA,YAAWmC,EAAX,uEAAc8B,QAAd;AAAA,eAA2B9B,GAAGgD,aAAH,CAAiBnF,CAAjB,CAA3B;AAAA,KAAX;;AAEA,QAAMoF,WAAY,SAAZA,QAAY,GAAiB;AAAA,YAAhBC,MAAgB,uEAAP,EAAO;;AAC/B,YAAIC,WAAW,EAAf;AAAA,YACIC,OAAO,KADX;;AAGA,YAAMC,SAAS,SAATA,MAAS,GAAoB;AAAA,gBAAnBC,SAAmB,uEAAP,EAAO;;AAC/BH,oDAAeA,QAAf,sBAA4BG,SAA5B;AACA,mBAAOC,QAAP;AACH,SAHD;;AAKA,YAAM/E,OAAO,SAAPA,IAAO;AAAA,gBAACgF,EAAD,uEAAI,CAAJ;AAAA,mBAAU,IAAI5G,OAAJ,CAAY;AAAA,uBAAOmC,WAAWlC,GAAX,EAAgB2G,EAAhB,CAAP;AAAA,aAAZ,CAAV;AAAA,SAAb;;AAEA,YAAMC,SAAS,SAATA,MAAS;AAAA,mBAAML,IAAN;AAAA,SAAf;;AAEA,YAAMG,SAAS,SAATA,MAAS,GAAM;AACjB,gBAAMG,QAAQP,SAAS3H,MAAvB;AACA,mBAAOgD,OAAOzB,IAAP,CAAY;AAAA,uBAAKH,QAAQ+G,GAAR,CAAYR,QAAZ,CAAL;AAAA,aAAZ,EAAwCpG,IAAxC,CAA6C,kBAAU;AAC1D,oBAAGoG,SAAS3H,MAAT,GAAkBkI,KAArB,EAA2B;AACvB,2BAAOH,QAAP;AACH;AACDH,uBAAO,IAAP;AACA,uBAAOF,MAAP;AACH,aANM,CAAP;AAOH,SATD;;AAWA,YAAMR,UAAU,SAAVA,OAAU,CAACkB,KAAD,EAAW;AACvB,gBAAMC,OAAOhI,OAAOgI,IAAP,CAAYD,KAAZ,CAAb;AACA,gBAAI,CAACC,KAAKrI,MAAV,EACI,OAAOoB,QAAQ8F,OAAR,CAAgB,IAAhB,CAAP;;AAEJ,gBAAIhG,IAAI,EAAR;AACAmH,iBAAKC,OAAL,CAAa,gBAAQ;AACjB,oBAAIrD,IAAImD,MAAM/D,IAAN,CAAR;;AAEA,uBAAMY,aAAapB,QAAnB;AACIoB,wBAAIA,GAAJ;AADJ,iBAGA,IAAGA,KAAKA,EAAE1D,IAAF,YAAkBsC,QAA1B,EACI3C,EAAE2D,IAAF,CAAOI,EAAE1D,IAAF,CAAO;AAAA,2BAAKmG,OAAOrD,IAAP,IAAe7C,CAApB;AAAA,iBAAP,CAAP;AACP,aARD;;AAUA,mBAAOqG,OAAO3G,CAAP,CAAP;AACH,SAjBD;;AAmBA,YAAMqH,WAAW,SAAXA,QAAW;AAAA,mBAAMb,MAAN;AAAA,SAAjB;;AAEA,eAAO,EAAEK,cAAF,EAAUb,gBAAV,EAAmBqB,kBAAnB,EAA6BZ,kBAA7B,EAAuCM,cAAvC,EAAP;AACH,KA9CD;;AAgDA,QAAMO,KAAK,SAALA,EAAK,CAACC,IAAD,EAAOC,KAAP,EAAiB;AACxB,YAAIC,IAAIF,KAAKC,KAAL,CAAR;AACA,eAAMC,aAAa9E,QAAnB;AACI8E,gBAAIF,KAAKG,SAASL,QAAT,EAAL,CAAJ;AADJ,SAEA,OAAOI,CAAP;AACH,KALD;;AAOA,QAAME,YAAY,SAAZA,SAAY,CAACJ,IAAD,EAA2C;AAAA,YAApCK,OAAoC,uEAA5B,EAA4B;AAAA,YAAxBF,QAAwB,uEAAfnB,UAAe;;AACzD,YAAIsB,eAAe,SAAfA,YAAe;AAAA,mBACfH,SAASX,MAAT,KAAoBQ,KAAKC,KAAL,CAApB,GAAkClF,EAAE,MAAF,CADnB;AAAA,SAAnB;;AAGA,eAAO,YAAM;AACT,gBAAImF,IAAIH,GAAGO,YAAH,EAAiBH,SAASL,QAAT,EAAjB,CAAR;AACAK,qBAAS1B,OAAT,CAAiB4B,OAAjB;;AAEA,gBAAGH,aAAa/E,KAAhB,EAAuB;AAAA;AACnB,wBAAIpC,IAAIoH,SAASb,MAAT,GAAkBxG,IAAlB,CAAuB;AAAA,+BAC3BiH,GAAGO,YAAH,EAAiBH,SAASL,QAAT,EAAjB,CAD2B;AAAA,qBAAvB,CAAR;;AAGA;AAAA,2BAAOI,EAAE3D,GAAF,CAAM,UAACC,CAAD,EAAGnF,CAAH,EAAS;AAClBmF,8BAAEiC,OAAF,GAAY;AAAA,uCAAK1F,EAAED,IAAF,CAAO;AAAA,2CAAQf,KAAKV,CAAL,CAAR;AAAA,iCAAP,CAAL;AAAA,6BAAZ;AACA,mCAAOmF,CAAP;AACH,yBAHM;AAAP;AAJmB;;AAAA;AAQtB;;AAED0D,cAAEzB,OAAF,GAAY;AAAA,uBAAK0B,SAASb,MAAT,GAAkBxG,IAAlB,CAAuB;AAAA,2BACpCiH,GAAGO,YAAH,EAAiBH,SAASL,QAAT,EAAjB,CADoC;AAAA,iBAAvB,CAAL;AAAA,aAAZ;;AAGA,mBAAOI,CAAP;AACH,SAlBD;AAmBH,KAvBD;;AAyBA,QAAMK,gBAAgB,CAAC,WAAD,EAAa,IAAb,CAAtB;;AAEA,QAAMC,SAAS,SAATA,MAAS,QAAS;AACpB,eAAMC,iBAAiBrF,QAAvB;AAAiCqF,oBAAQA,OAAR;AAAjC,SACA,IAAGA,iBAAiBtF,KAApB,EAA2B,OAAO,IAAIxC,OAAJ,CAAY;AAAA,mBAAKuH,EAAEQ,yCAAQD,KAAR,EAAF,CAAL;AAAA,SAAZ,CAAP;AAC3B,YAAG,CAACA,KAAJ,EAAW,OAAO,IAAI9H,OAAJ,CAAY;AAAA,mBAAKuH,EAAE,EAAF,CAAL;AAAA,SAAZ,CAAP;AACX,YAAG,QAAOO,KAAP,yCAAOA,KAAP,OAAiB,QAApB,EAA8B,OAAO,IAAI9H,OAAJ,CAAY;AAAA,mBAAKuH,EAAEO,KAAF,CAAL;AAAA,SAAZ,CAAP;AAC9B,eAAO,CAACA,MAAMhC,OAAN,GAAgBgC,MAAMhC,OAAN,EAAhB,GAAkC9F,QAAQ8F,OAAR,EAAnC,EAAsD3F,IAAtD,CAA2D,gBAAQ;AACtE,gBAAG,CAACf,IAAJ,EAAUA,OAAO0I,KAAP;;AAEV,gBAAG1I,gBAAgBoD,KAAnB,EAA0B,OAAO,IAAIxC,OAAJ,CAAY;AAAA,uBAAKuH,EAAEQ,yCAAQ3I,IAAR,EAAF,CAAL;AAAA,aAAZ,CAAP;;AAH4C,yBAKdA,IALc;AAAA,gBAK/D8B,GAL+D,UAK/DA,GAL+D;AAAA,gBAK1DO,EAL0D,UAK1DA,EAL0D;AAAA,gBAKtDF,SALsD,UAKtDA,SALsD;AAAA,gBAK3CgB,KAL2C,UAK3CA,KAL2C;AAAA,gBAKpCD,QALoC,UAKpCA,QALoC;AAAA,gBAK1BkF,QAL0B,UAK1BA,QAL0B;AAAA,gBAMlE7C,GANkE,GAM3DlD,MAAOc,SAASA,MAAMd,EAAvB,cAAuCA,MAAOc,SAASA,MAAMd,EAAtB,IAA6B,EAApE,UAA6E,EANjB;AAAA,gBAOlEuG,MAPkE,GAOxDzG,aAAcgB,SAASA,MAAMhB,SAA9B,gBAAuD,CAAC,CAACA,aAAW,EAAZ,IAAkB,GAAlB,IAAyBgB,MAAMhB,SAAN,IAAiB,EAA1C,CAAD,EAAgDC,IAAhD,EAAvD,SAAmH,EAP1D;;AAStE,gBAAM2B,SAASJ,YAAY3D,IAAZ,CAAf;AACA,gBAAI6I,SAAS,EAAb;AAAA,gBACIC,QAAQ,EADZ;AAEA,iBAAI,IAAIxJ,CAAR,IAAc6D,SAAStD,OAAOoC,MAAP,CAAc,IAAd,CAAvB,EAA4C;AACxC,oBAAG3C,MAAM,OAAT,EAAiB;AACbuJ,2CAAqB7D,QAAQ7B,MAAM7D,CAAN,CAAR,CAArB;AACH,iBAFD,MAEO,IAAGA,MAAM,WAAT,EAAsB;AACzBwJ,4BAAQ3F,MAAM7D,CAAN,CAAR;AACH,iBAFM,MAEA,IAAGkJ,cAAcO,OAAd,CAAsBzJ,CAAtB,MAA6B,CAAC,CAAjC,EAAmC;AACtCuJ,oCAAcvJ,CAAd,UAAoB6D,MAAM7D,CAAN,CAApB;AACH;AACJ;;AAED,gBAAG,CAACwJ,KAAD,IAAU5F,QAAb,EACI,OAAOyF,yCAAQzF,QAAR,GAAkBnC,IAAlB,CAAuB;AAAA,6BACtBe,GADsB,GAChByD,GADgB,GACVqD,MADU,GACDC,MADC,SACSG,GADT,UACiBlH,GADjB;AAAA,aAAvB,CAAP;;AAGJ,gBAAG,eAAeyC,KAAf,CAAqB,GAArB,EAA0B0E,MAA1B,CAAiC;AAAA,uBAAKxE,MAAI3C,GAAT;AAAA,aAAjC,EAA+CtC,MAA/C,KAA0D,CAA7D,EACI,OAAO,IAAIoB,OAAJ,CAAY;AAAA,uBAAKuH,QAAMrG,GAAN,GAAYyD,GAAZ,GAAkBqD,MAAlB,GAA2BC,MAA3B,SAAqCC,KAArC,UAA+ChH,GAA/C,OAAL;AAAA,aAAZ,CAAP;;AAEJ,mBAAO,IAAIlB,OAAJ,CAAY;AAAA,uBAAKuH,QAAMrG,GAAN,GAAYyD,GAAZ,GAAkBqD,MAAlB,GAA2BC,MAA3B,SAAL;AAAA,aAAZ,CAAP;AACH,SA9BM,CAAP;AA+BH,KApCD;;AAsCA,QAAMF,OAAO,SAAPA,IAAO;AAAA,2CAAIzJ,CAAJ;AAAIA,aAAJ;AAAA;;AAAA,eAAU0B,QAAQ+G,GAAR,CAAYzI,EAAEsF,GAAF,CAAMiE,MAAN,CAAZ,EAA2B1H,IAA3B,CAAgC;AAAA,mBAAK0D,EAAEwE,MAAF,CAAS;AAAA,uBAAK,CAAC,CAACxE,CAAP;AAAA,aAAT,EAAmByE,IAAnB,CAAwB,EAAxB,CAAL;AAAA,SAAhC,CAAV;AAAA,KAAb;;AAEA,WAAO,EAACb,oBAAD,EAAYM,UAAZ,EAAkB5B,MAAlB,EAAsBhC,cAAtB,EAA8BJ,YAA9B,EAAqC3B,IAArC,EAAwCV,kBAAxC,EAAP;AACH,CA3YD;;AA6YA3C,OAAOC,OAAP,GAAiBI,MAAjB;;AAEA;;;;;;;;;;;;;;;;;;;;AAoBA;;;;;;;;;;;;;;;;;;;;;;;;ACtaO,IAAMmJ,oBAAM,SAANA,GAAM;AAAA;;AAAA,WAAU,qBAAQA,GAAR,2BAAV;AAAA,CAAZ;;AAEP;AACO,IAAMC,oBACP,CAAC,CAACC,OAAOvD,QAAT,KACCuD,OAAOC,qBAAP,IACDD,OAAOE,2BADN,IAEDF,OAAOG,wBAHP,KAIC;AAAA,WAAMzG,WAAW0G,EAAX,EAAe,IAAf,CAAN;AAAA,CALA;;AAOP;AACA;AACO,IAAMhK,gBAAI,SAAJA,CAAI,CAACiB,CAAD,EAAGgJ,CAAH;AAAA,WAAS;AAAA,eAAKhJ,EAAEgJ,EAAEjF,CAAF,CAAF,CAAL;AAAA,KAAT;AAAA,CAAV;;AAEP;AACA;AACO,IAAMkF,oBAAM,SAANA,GAAM;AAAA,sCAAIC,GAAJ;AAAIA,WAAJ;AAAA;;AAAA,WAAYA,IAAIC,MAAJ,CAAW,UAACC,GAAD,EAAKlF,EAAL;AAAA,eAAYnF,EAAEqK,GAAF,EAAOlF,EAAP,CAAZ;AAAA,KAAX,CAAZ;AAAA,CAAZ;;AAEP;AACA;AACO,IAAMmF,oBAAM,SAANA,GAAM;AAAA,uCAAIH,GAAJ;AAAIA,WAAJ;AAAA;;AAAA,WAAYD,wCAAOC,IAAII,OAAJ,EAAP,EAAZ;AAAA,CAAZ;;AAEP;AACA;AACO,IAAMC,kBAAK,SAALA,EAAK;AAAA,WAAM;AAAA,2CAAItH,IAAJ;AAAIA,gBAAJ;AAAA;;AAAA,eAAa;AAAA,mBAAKiC,GAAGsF,KAAH,CAASzF,CAAT,EAAY9B,IAAZ,CAAL;AAAA,SAAb;AAAA,KAAN;AAAA,CAAX;;AAEP;AACA;AACO,IAAMwH,wBAAQ,SAARA,KAAQ,CAACvF,EAAD;AAAA,uCAAQjC,IAAR;AAAQA,YAAR;AAAA;;AAAA,WACpBiC,GAAGwF,IAAH,YAAQjJ,SAAR,SAAsBwB,IAAtB,EADoB;AAAA,CAAd;;AAIP;AACO,IAAM0H,4BAAU,SAAVA,OAAU,CAACC,MAAD;AAAA,WAAY;AAC/B,kBAACC,OAAD;AAAA,mBAAa;AACT,0BAACC,MAAD,EAASnF,KAAT;AAAA,2BACIkF,QAAQC,MAAR,EAAgBF,OAAOjF,KAAP,CAAhB,CADJ;AAAA;AADJ;AAAA;AADmB;AAAA,CAAhB;;AAKA,IAAMoF,gCAAY,SAAZA,SAAY,CAACC,SAAD;AAAA,WAAe;AACpC,kBAACH,OAAD;AAAA,mBAAa;AACT,0BAACC,MAAD,EAASnF,KAAT;AAAA,2BACIqF,UAAUrF,KAAV,IAAmBkF,QAAQC,MAAR,EAAgBnF,KAAhB,CAAnB,GAA4CmF,MADhD;AAAA;AADJ;AAAA;AADqB;AAAA,CAAlB;;AAKA,IAAMG,gCAAY,SAAZA,SAAY,CAACC,KAAD,EAAQvF,KAAR;AAAA,WACrBuF,MAAMC,MAAN,CAAa,CAACxF,KAAD,CAAb,CADqB;AAAA,CAAlB;;;;;;;;AC1CP,IAAMpF,QAAQ,SAARA,KAAQ,GAAgB;AAAA,sCAAZ6K,OAAY;AAAZA,eAAY;AAAA;;AAAA,QACpBC,MADoB;AAAA;AAAA;;AAG1B,QAAIC,QAAQD,OAAOE,SAAnB;;AAEAH,YAAQtG,GAAR,CAAY,gBAAmB;AAAA,YAAP0G,CAAO,QAAjBD,SAAiB;;AAC3BpL,eAAOsL,mBAAP,CAA2BD,CAA3B,EAA8B1G,GAA9B,CAAkC,eAAO;AACrC,gBAAI4G,QAAQJ,MAAMxK,GAAN,KAAe,aAAK,CAAE,CAAlC;AACAwK,kBAAMxK,GAAN,IAAa,YAAW;AACpB4K,sBAAMlB,KAAN,CAAY,IAAZ,EAAkB,GAAGnI,KAAH,CAASsJ,IAAT,CAAcC,SAAd,CAAlB;AACA,uBAAOJ,EAAE1K,GAAF,EAAO0J,KAAP,CAAa,IAAb,EAAmB,GAAGnI,KAAH,CAASsJ,IAAT,CAAcC,SAAd,CAAnB,CAAP;AACH,aAHD;AAIH,SAND;AAOH,KARD;;AAUA,WAAOP,MAAP;AACH,CAhBD;;AAkBApL,OAAOC,OAAP,GAAiBK,KAAjB;;;;;;;;;;;;ACnBA;AACA,IAAMC,QAAQ;AACVqL,MADU,cACPC,IADO,EACDnG,KADC,EACM;AACZ,YAAGmG,QAAQA,KAAKC,OAAL,YAAwBpI,QAAnC,EAA4C;AACxC,mBAAOmI,KAAKC,OAAL,CAAapG,KAAb,CAAP;AACH,SAFD,MAEO,IAAImG,SAASE,MAAT,KAAqBrG,iBAAiBqG,MAAlB,IAA6B,OAAOrG,KAAP,KAAiB,QAAlE,CAAD,IACFmG,SAASG,MAAT,KAAqBtG,iBAAiBsG,MAAlB,IAA6B,OAAOtG,KAAP,KAAiB,QAAlE,CADE,IAEFmG,SAASI,OAAT,KAAsBvG,iBAAiBuG,OAAlB,IAA8B,OAAOvG,KAAP,KAAiB,SAApE,CAFE,IAGFmG,SAASnI,QAAT,KAAuBgC,iBAAiBhC,QAAlB,IAA+B,OAAOgC,KAAP,KAAiB,UAAtE,CAHE,IAIFmG,SAAS3L,MAAT,KAAqBwF,iBAAiBxF,MAAlB,IAA6B,QAAOwF,KAAP,yCAAOA,KAAP,OAAiB,QAAlE,CAJE,IAKFmG,SAASrK,SALV,EAMN;AACG,mBAAO,IAAP;AACH;;AAED,eAAO,KAAP;AACH,KAfS;AAgBV0K,SAhBU,iBAgBJC,KAhBI,EAgBGC,QAhBH,EAgBa3K,IAhBb,EAgBmB;AACzBvB,eAAOgI,IAAP,CAAYiE,KAAZ,EAAmBhE,OAAnB,CAA2B,eAAO;AAC9B,gBAAIjC,IAAIiG,MAAMtL,GAAN,CAAR;AAAA,gBACI6E,QAAQjE,KAAKZ,GAAL,CADZ;;AAGA,gBAAGuL,SAASvL,GAAT,KAAiB6E,UAAUlE,SAA9B,EAAwC;AACpC,oBAAG,EAAE0E,aAAazC,KAAf,CAAH,EAA0ByC,IAAI,CAACA,CAAD,CAAJ;;AAE1B,oBAAIvG,IAAIuG,EAAEgE,MAAF,CAAS,UAACjG,CAAD,EAAGoI,KAAH;AAAA,2BAAapI,KAAKqI,MAAMV,EAAN,CAASS,KAAT,EAAgB3G,KAAhB,CAAlB;AAAA,iBAAT,EAAmD,KAAnD,CAAR;AACA,oBAAG,CAAC/F,CAAJ,EAAO;AACH,gCAAUkB,GAAV,UAAkBpB,KAAKC,SAAL,CAAegG,KAAf,CAAlB,wBAA0DQ,EAAErB,GAAF,CAAM;AAAA,yCAAaC,CAAb;AAAA,qBAAN,CAA1D;AACH;AACJ;AACJ,SAZD;;AAcA,eAAO,IAAP;AACH,KAhCS;AAiCVyH,QAjCU,kBAiCI;AACV,YAAIJ,cAAJ;AAAA,YAAWC,iBAAX;AAAA,YAAqBI,cAArB;;AADU,0CAANxJ,IAAM;AAANA,gBAAM;AAAA;;AAEVA,aAAK6B,GAAL,CAAS,aAAK;AACV,gBAAGC,aAAapB,QAAb,IAAyB,CAAC8I,KAA7B,EAAmC;AAAEA,wBAAQ1H,CAAR;AAAW,aAAhD,MACK,IAAG,QAAOA,CAAP,yCAAOA,CAAP,OAAa,QAAhB,EAA0B;AAC3B,oBAAG,CAACqH,KAAJ,EAAU;AAAEA,4BAAQrH,CAAR;AAAW,iBAAvB,MACK,IAAG,CAACsH,QAAJ,EAAa;AAAEA,+BAAWtH,CAAX;AAAc;AACrC;AACJ,SAND;;AAQA,YAAMgH,UAAU,SAAVA,OAAU,CAACrK,IAAD,EAAU;AACtB,gBAAMgL,OAAOD,QAAQ,CAACN,KAAD,EAAQM,KAAR,CAAR,GAAyB,CAACN,KAAD,CAAtC;AACA,mBAAOO,KAAKvC,MAAL,CAAY,UAACjG,CAAD,EAAG1E,CAAH;AAAA,uBAAS0E,KAAK1E,EAAE4M,SAAO,EAAT,EAAYC,YAAU,EAAtB,EAAyB3K,IAAzB,CAAd;AAAA,aAAZ,EAA0D,IAA1D,CAAP;AACH,SAHD;;AAKA,YAAMiL,YAAY,SAAZA,SAAY,CAACjL,IAAD;AAAA,mBAAU,IAAIR,OAAJ,CAAY,UAACC,GAAD,EAAKC,GAAL;AAAA,uBAAa2K,QAAQrK,IAAR,KAAiBP,IAAIO,IAAJ,CAA9B;AAAA,aAAZ,CAAV;AAAA,SAAlB;;AAEA,eAAO,EAACqK,gBAAD,EAAUY,oBAAV,EAAP;AACH,KAnDS;AAoDVC,WApDU,mBAoDFC,CApDE,EAoDC;AACP,eAAON,MAAMC,IAAN,CAAW,UAACrG,CAAD,EAAGsC,CAAH,EAAK/G,IAAL,EAAc;AAC5B,gBAAG,EAAEA,gBAAgBgC,KAAlB,CAAH,EAA6B,MAAShC,IAAT;AAC7BA,iBAAKoD,GAAL,CAAS,aAAK;AACV,oBAAG,CAACyH,MAAMV,EAAN,CAASgB,CAAT,EAAY9H,CAAZ,CAAJ,EACI,MAASA,CAAT;AACP,aAHD;AAIA,mBAAO,IAAP;AACH,SAPM,CAAP;AAQH;AA7DS,CAAd;;kBAgEevE;;AAEf;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnEA;AACA,IAAMC,MAAM,SAANA,GAAM,CAAC+H,KAAD,EAAW;AACnB,QAAIsE,cAAc,EAAlB;;AAEA,QAAM5H,KAAK,SAALA,EAAK,CAAC6H,GAAD,EAAS;AAChB,YAAGA,QAAQtL,SAAX,EAAqB;AACjB+G,oBAAQuE,GAAR;AACA,iBAAI,IAAInN,IAAI,CAAR,EAAWC,MAAMiN,YAAYhN,MAAjC,EAAyCF,IAAEC,GAA3C,EAAgDD,GAAhD;AACCkN,4BAAYlN,CAAZ,EAAemN,GAAf;AADD;AAEH;AACD,eAAOvE,KAAP;AACH,KAPD;;AASAtD,OAAGJ,GAAH,GAAS,aAAK;AACZ,YAAMkI,IAAIvM,KAAV;AACAqM,oBAAYnI,IAAZ,CAAiB;AAAA,mBAAOqI,EAAEhM,EAAE+L,GAAF,CAAF,CAAP;AAAA,SAAjB;AACA,eAAOC,CAAP;AACD,KAJD;;AAMA9H,OAAGqE,MAAH,GAAY,aAAK;AACf,YAAMyD,IAAIvM,KAAV;AACAqM,oBAAYnI,IAAZ,CAAiB;AAAA,mBAAO3D,EAAE+L,GAAF,KAAUC,EAAED,GAAF,CAAjB;AAAA,SAAjB;AACA,eAAOC,CAAP;AACD,KAJD;;AAMA9H,OAAG7D,IAAH,GAAU,aAAK;AACbyL,oBAAYnI,IAAZ,CAAiB;AAAA,mBAAO3D,EAAE+L,GAAF,CAAP;AAAA,SAAjB;AACA,eAAO7H,EAAP;AACD,KAHD;;AAKAA,OAAG+H,IAAH,GAAU,UAACC,CAAD,EAAO;AACb,YAAMC,SAAS,EAAf;AAAA,YACCH,IAAIvM,KADL;;AAGA,YAAMsJ,KAAK,SAALA,EAAK,MAAO;AACd,gBAAGoD,OAAOrN,MAAP,GAAgBoN,CAAnB,EACIC,OAAOxI,IAAP,CAAYoI,GAAZ;;AAEJ,gBAAGI,OAAOrN,MAAP,KAAkBoN,CAArB,EAAwB;AACpBJ,4BAAYM,MAAZ,CAAmBrD,EAAnB;AACA,uBAAOiD,EAAEG,MAAF,CAAP;AACH;AACJ,SARD;;AAUAL,oBAAYnI,IAAZ,CAAiBoF,EAAjB;;AAEA,eAAOiD,CAAP;AACH,KAjBD;;AAmBA9H,OAAGmI,SAAH,GAAe,aAAK;AAChB,YAAMF,SAAS,EAAf;AAAA,YACCH,IAAIvM,KADL;;AAGA,YAAMsJ,KAAK,SAALA,EAAK,MAAO;AACd,gBAAG,CAAC/I,EAAE+L,GAAF,CAAJ,EAAY;AACRD,8BAAcA,YAAYvD,MAAZ,CAAmB;AAAA,2BAAKxE,MAAMgF,EAAX;AAAA,iBAAnB,CAAd;AACA,uBAAOiD,EAAEG,MAAF,CAAP;AACH;;AAEVA,mBAAOxI,IAAP,CAAYoI,GAAZ;AACM,SAPD;;AASAD,oBAAYnI,IAAZ,CAAiBoF,EAAjB;;AAEA,eAAOiD,CAAP;AACH,KAhBD;;AAkBA9H,OAAGiF,MAAH,GAAY,UAACnJ,CAAD,EAAGoJ,GAAH,EAAW;AACnB,YAAM4C,IAAIvM,KAAV;;AAEAqM,oBAAYnI,IAAZ,CAAiB,eAAO;AACpByF,kBAAMpJ,EAAEoJ,GAAF,EAAM2C,GAAN,CAAN;AACAC,cAAE5C,GAAF;AACH,SAHD;;AAKA,eAAO4C,CAAP;AACH,KATD;;AAWA9H,OAAGoI,KAAH,GAAW,aAAK;AACZ,YAAMC,UAAU9M,KAAhB;AAAA,YACMmB,QAAQnB,KADd;AAAA,YAEMsJ,KAAK,SAALA,EAAK;AAAA,mBACT/I,EAAE+L,GAAF,EACD1L,IADC,CACI;AAAA,uBAAKkM,QAAQjM,CAAR,CAAL;AAAA,aADJ,EAEWC,KAFX,CAEiB;AAAA,uBAAKK,MAAMJ,CAAN,CAAL;AAAA,aAFjB,CADS;AAAA,SAFX;;AAOAsL,oBAAYnI,IAAZ,CAAiBoF,EAAjB;;AAEA,eAAO,CAAEwD,OAAF,EAAW3L,KAAX,CAAP;AACH,KAXD;;AAaAsD,OAAGsI,IAAH,GAAU;AAAA,eAAMV,cAAc,EAApB;AAAA,KAAV;;AAEA5H,OAAGtC,QAAH,GAAc,cAAM;AAChB,YAAMoK,IAAIvM,KAAV;AACA,YAAIgN,KAAK,CAAC,IAAIC,IAAJ,EAAV;AACAZ,oBAAYnI,IAAZ,CAAiB,eAAO;AACpB,gBAAMgJ,MAAM,CAAC,IAAID,IAAJ,EAAb;AACA,gBAAGC,MAAMF,EAAN,IAAY3F,EAAf,EAAkB;AACd2F,qBAAK,CAAC,IAAIC,IAAJ,EAAN;AACAV,kBAAED,GAAF;AACH;AACJ,SAND;AAOA,eAAOC,CAAP;AACH,KAXD;;AAaA,WAAO9H,EAAP;AACH,CA1GD;;AA4GAzE,IAAImN,IAAJ,GAAW,aAAK;AACZ,QAAMZ,IAAIvM,KAAV;AACAO,MAAE;AAAA,eAAKgM,EAAEjI,CAAF,CAAL;AAAA,KAAF;AACA,WAAOiI,CAAP;AACH,CAJD;;AAMAvM,IAAIoN,KAAJ,GAAY,YAAW;AAAA,sCAAPC,EAAO;AAAPA,UAAO;AAAA;;AACnB,QAAMd,IAAIvM,KAAV;AACAqN,OAAGhJ,GAAH,CAAO;AAAA,eAAK9D,EAAEK,IAAF,CAAO2L,CAAP,CAAL;AAAA,KAAP;AACA,WAAOA,CAAP;AACH,CAJD;;kBAMevM;;;;;;;;;ACzHf;AACO,IAAMsN,4BAAU,SAAVA,OAAU,IAAK;AACxBhJ,SAAOA,KAAK,CAAN,GAAW,UAAjB;AACAA,QAAI,CAACA,IAAI,UAAL,KAAqBA,KAAK,CAAN,GAAW,UAA/B,CAAJ;AACAA,QAAKA,KAAKA,KAAK,CAAV,CAAD,GAAiB,UAArB;AACAA,SAAMA,KAAK,CAAX;AACAA,SAAMA,KAAK,EAAX;AACA,WAAQA,IAAI,IAAZ;AACH,CAPM;;AASA,IAAMiJ,8BAAW,SAAXA,QAAW,OAAQ;AAC5B,QAAGC,KAAKnN,GAAR,EACI,OAAO,CAAP;;AAEJ,QAAIf,IAAIkO,KAAKzK,QAAb;AACA,QAAGzD,CAAH,EAAM;AACF,YAAImO,MAAM,CAAV;AACA,aAAI,IAAItO,CAAR,IAAaG,CAAb;AAAgBmO,mBAAOF,SAASjO,EAAEH,CAAF,CAAT,CAAP;AAAhB,SACA,OAAOsO,GAAP;AACH;AACJ,CAVM;;AAYP;AACO,IAAM3O,sBAAO,gBAAU;AAAA,QAATC,CAAS,uEAAP,EAAO;;AAC1BA,QAAIE,KAAKC,SAAL,CAAeH,CAAf,CAAJ;AACA,QAAID,OAAO,IAAX;AACA,SAAK,IAAIK,IAAI,CAAb,EAAgBA,IAAIJ,EAAEM,MAAtB,EAA8BF,GAA9B;AACIL,eAAQ,CAACA,QAAQ,CAAT,IAAcA,IAAf,GAAuBC,EAAEQ,UAAF,CAAaJ,CAAb,CAA9B;AADJ,KAEA,OAAOL,IAAP;AACH,CANM;;AAQP;AACO,IAAM4O,sBAAO,SAAPA,IAAO,CAACjK,CAAD,EAAGkK,CAAH;AAAA,WAAS7O,KAAK2E,CAAL,MAAY3E,KAAK6O,CAAL,CAArB;AAAA,CAAb;;AAEP;AACO,IAAMC,gCAAY,CAAlB;AACA,IAAMC,gCAAY,KAAKD,SAAL,GAAiB,CAAnC;AACA,IAAME,oBAAM,SAANA,GAAM;AAAA,QAACC,CAAD,uEAAG,CAAH;AAAA,QAAM5O,CAAN,uEAAQ,CAAR;AAAA,QAAW6O,KAAX,uEAAiBJ,SAAjB;AAAA,WAAgCG,MAAOC,QAAM7O,CAAd,GAAqB,CAAC,KAAK6O,KAAN,IAAe,CAAnE;AAAA,CAAZ;;AAEA,IAAMC,sCAAe,SAAfA,YAAe,IAAK;AAC7B,QAAIC,IAAIxO,OAAOoC,MAAP,CAAc,IAAd,CAAR;AACA,SAAI,IAAI3C,CAAR,IAAamF,CAAb;AACI4J,UAAE/O,CAAF,IAAOmF,EAAEnF,CAAF,CAAP;AADJ,KAEA,OAAO+O,CAAP;AACH,CALM;;AAOA,IAAMC,gCAAY,SAAZA,SAAY,IAAK;AAC1B,QAAID,IAAIE,MAAR;AACA,QAAG,CAAC9J,CAAJ,EAAO,OAAO4J,CAAP;;AAEP,QAAG5J,EAAEvB,QAAL,EAAe;AACXmL,UAAEnL,QAAF,GAAakL,aAAa3J,EAAEvB,QAAf,CAAb;AACH,KAFD,MAEO,IAAGuB,EAAEjE,GAAF,KAAUW,SAAb,EAAwB;AAC3BkN,UAAE7N,GAAF,GAAQiE,EAAEjE,GAAV;AACA6N,UAAE5B,GAAF,GAAQhI,EAAEgI,GAAV;AACA4B,UAAEpP,IAAF,GAASwF,EAAExF,IAAX;AACH;;AAED,WAAOoP,CAAP;AACH,CAbM;;AAeA,IAAMG,oCAAc,SAAdA,WAAc,IAAK;AAC5B,QAAI/O,IAAI,CAAR;AACA,SAAI,IAAIH,CAAR,IAAamF,CAAb;AAAgB,UAAEhF,CAAF;AAAhB,KACA,OAAOA,CAAP;AACH,CAJM;;AAMA,IAAMgP,oBAAM,SAANA,GAAM,CAACd,IAAD,EAAOnN,GAAP,EAAYiM,GAAZ,EAAoB;AACnC,QAAIkB,KAAKnN,GAAL,KAAaW,SAAd,IAA4B,CAACwM,KAAKzK,QAArC,EAA+C,OAAOqL,KAAK/N,GAAL,EAAUiM,GAAV,CAAP;;AAE/C,QAAMiC,UAAUJ,UAAUX,IAAV,CAAhB;AAAA,QAAiCO,IAAIjP,KAAKuB,GAAL,CAArC;;AAEA;AACA,SAAI,IAAIlB,IAAI,CAAR,EAAW6I,IAAIwF,IAAf,EAAqBf,IAAI8B,OAA7B,EAAsCpP,KAAK,CAA3C,EAA8C,EAAEA,CAAhD,EAAkD;AAC9C,YAAIqP,OAAOV,IAAIC,CAAJ,EAAO5O,CAAP,CAAX;;AAEA,YAAG6I,EAAE3H,GAAF,KAAUW,SAAb,EAAuB;AACnB;AACA,gBAAGgH,EAAE3H,GAAF,KAAUA,GAAV,IAAiBlB,MAAM,CAA1B,EAA6B;AACzB;AACAsN,kBAAEH,GAAF,GAAQA,GAAR;AACH,aAHD,MAGO,IAAGnN,MAAM,CAAT,EAAY;AACf;AACA;AACA;;AAEA;AACA;AACA,oBAAIsP,KAAKL,KAAKpG,EAAE3H,GAAP,EAAY2H,EAAEsE,GAAd,EAAmBtE,EAAElJ,IAArB,CAAT;AACA,oBAAI4P,KAAKN,KAAK/N,GAAL,EAAUiM,GAAV,EAAeyB,CAAf,CAAT;AACA,oBAAIY,KAAK3G,EAAElJ,IAAX;;AAEA;AACA,uBAAOkJ,EAAE3H,GAAT;AACA,uBAAO2H,EAAEsE,GAAT;AACA,uBAAOtE,EAAElJ,IAAT;AACA,uBAAO2N,EAAEpM,GAAT;AACA,uBAAOoM,EAAEH,GAAT;AACA,uBAAOG,EAAE3N,IAAT;;AAEA;AACA,qBAAI,IAAI8P,IAAIzP,CAAR,EAAW0P,MAAM7G,CAAjB,EAAoB8G,MAAMrC,CAA9B,EAAiCmC,KAAK,CAAtC,EAAyCA,GAAzC,EAA6C;AACzC,wBAAIG,OAAOjB,IAAIa,EAAJ,EAAQC,CAAR,CAAX;AAAA,wBACII,OAAOlB,IAAIC,CAAJ,EAAOa,CAAP,CADX;;AAGA;AACA,wBAAItP,IAAIuP,IAAI9L,QAAJ,GAAerD,OAAOoC,MAAP,CAAc,IAAd,CAAvB;AACA,wBAAIjB,IAAIiO,IAAI/L,QAAJ,GAAekL,aAAa3O,CAAb,CAAvB;;AAEA,wBAAGyP,SAASC,IAAZ,EAAkB;AACd1P,0BAAEyP,IAAF,IAAUN,EAAV;AACA5N,0BAAEkO,IAAF,IAAUN,EAAV;AACA5N,0BAAEmO,IAAF,IAAUN,EAAV;AACA;AACH,qBALD,MAKO;AACHG,8BAAMvP,EAAEyP,IAAF,IAAUX,MAAhB;AACAU,8BAAMjO,EAAEmO,IAAF,IAAUb,UAAUU,GAAV,CAAhB;AACH;AACJ;AACJ;AACD;AACH,SA7CD,MA6CO,IAAG7G,EAAEjF,QAAL,EAAe;AAClB,gBAAIkM,KAAKjH,EAAEjF,QAAF,CAAWyL,IAAX,CAAT;AACA,gBAAG,CAACS,EAAJ,EAAQ;AACJxC,oBAAIA,EAAE1J,QAAF,CAAWyL,IAAX,IAAmBJ,KAAK/N,GAAL,EAAUiM,GAAV,CAAvB;AACA;AACH,aAHD,MAGO;AACHtE,oBAAIiH,EAAJ;AACAxC,oBAAIA,EAAE1J,QAAF,CAAWyL,IAAX,IAAmBL,UAAUnG,CAAV,CAAvB;AACH;AACJ;AACJ;;AAED,WAAOuG,OAAP;AACH,CAnEM;;AAqEA,IAAMW,oBAAM,SAANA,GAAM,CAAC1B,IAAD,EAAOnN,GAAP,EAAe;AAC9B,QAAGmN,KAAKnN,GAAL,KAAaA,GAAhB,EAAqB,OAAOmN,KAAKlB,GAAZ;AACrB,QAAMyB,IAAIjP,KAAKuB,GAAL,CAAV;AACA,SAAI,IAAIlB,IAAI,CAAR,EAAW6I,IAAIwF,IAAnB,EAAyBrO,KAAK,CAA9B,EAAiC,EAAEA,CAAnC,EAAqC;AACjC,YAAG,CAAC6I,EAAEjF,QAAN,EAAgB,OAAO/B,SAAP;AAChBgH,YAAIA,EAAEjF,QAAF,CAAW+K,IAAIC,CAAJ,EAAO5O,CAAP,CAAX,CAAJ;AACA,YAAG,CAAC6I,CAAJ,EAAO,OAAOhH,SAAP;AACP,YAAGgH,EAAE3H,GAAF,KAAUW,SAAb,EAAwB,OAAOgH,EAAEsE,GAAT;AAC3B;;AAED,WAAOtL,SAAP;AACH,CAXM;;AAaA,IAAMmO,wBAAQ,SAARA,KAAQ,OAAQ;AACzB,QAAI7P,IAAIkO,KAAKzK,QAAb;AACA,SAAI,IAAI5D,CAAR,IAAaG,CAAb;AAAgB,eAAOA,EAAEH,CAAF,CAAP;AAAhB;AACH,CAHM;;AAKA,IAAMiQ,wBAAQ,SAARA,KAAQ,CAAC5B,IAAD,EAAOnN,GAAP,EAAe;AAChC,QAAMoM,IAAI0B,UAAUX,IAAV,CAAV;AAAA,QACMO,IAAIjP,KAAKuB,GAAL,CADV;;AAGA,SAAI,IAAIlB,IAAI,CAAR,EAAWkQ,KAAK5C,CAAhB,EAAmB1B,IAAI0B,CAA3B,EAA8BtN,KAAK,CAAC,CAApC,EAAuC,EAAEA,CAAzC,EAA4C;AACxC,YAAGkQ,GAAGhP,GAAN,EAAW;AACP,mBAAOgP,GAAGhP,GAAV;AACA,mBAAOgP,GAAG/C,GAAV;AACA,mBAAO+C,GAAGvQ,IAAV;AACA,mBAAO2N,CAAP;;AAEZ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACS;;AAED,YAAM+B,OAAOV,IAAIC,CAAJ,EAAO5O,CAAP,CAAb;AACAkQ,aAAKA,MAAMA,GAAGtM,QAAT,IAAqBsM,GAAGtM,QAAH,CAAYyL,IAAZ,CAA1B;AACA,YAAG,CAACa,EAAJ,EAAQ,OAAO5C,CAAP;AACR1B,YAAIsE,EAAJ;AACH;AACD,WAAO5C,CAAP;AACH,CAzCM;;AA2CA,IAAM2B,sBAAO,SAAPA,IAAO,CAAC/N,GAAD,EAAKiM,GAAL,EAA+C;AAAA,QAAtCyB,CAAsC,uEAAnC1N,QAAQW,SAAR,IAAqBlC,KAAKuB,GAAL,CAAc;;AAC/D;;;;;;;AAOA,QAAIiP,OAAO5P,OAAOoC,MAAP,CAAc,IAAd,CAAX;AACA,QAAGzB,QAAQW,SAAX,EAAqB;AACjBsO,aAAKjP,GAAL,GAAWA,GAAX;AACAiP,aAAKxQ,IAAL,GAAYiP,CAAZ;AACAuB,aAAKhD,GAAL,GAAWA,GAAX;AACH;AACD,WAAOgD,IAAP;AACH,CAfM;;AAiBA,IAAMjL,oBAAM,SAANA,GAAM,CAACmJ,IAAD,EAAO/I,EAAP,EAAc;AAC7B,QAAG+I,KAAKnN,GAAL,KAAaW,SAAhB,EACI,OAAOoN,KAAKZ,KAAKnN,GAAV,EAAeoE,GAAG+I,KAAKlB,GAAR,EAAakB,KAAKnN,GAAlB,CAAf,EAAuCmN,KAAK1O,IAA5C,CAAP;;AAEJ,QAAI+B,IAAIsN,UAAUX,IAAV,CAAR;AAAA,QACIlO,IAAIuB,EAAEkC,QADV;;AAGA,QAAGzD,CAAH,EAAM;AACF,aAAI,IAAIH,CAAR,IAAaG,CAAb,EAAe;AACXA,cAAEH,CAAF,IAAOkF,IAAI/E,EAAEH,CAAF,CAAJ,EAAUsF,EAAV,CAAP;AACH;AACJ;;AAED,WAAO5D,CAAP;AACH,CAdM;;AAgBA,IAAMiI,0BAAS,SAATA,MAAS,CAAC0E,IAAD,EAAO/I,EAAP,EAAc;AAChC,QAAG+I,KAAKnN,GAAL,KAAaW,SAAhB,EACI,OAAOyD,GAAG+I,KAAKlB,GAAR,EAAakB,KAAKnN,GAAlB,IAAyBmN,IAAzB,GAAgCxM,SAAvC;;AAEJ,QAAIH,IAAIsN,UAAUX,IAAV,CAAR;AAAA,QACIlO,IAAIuB,EAAEkC,QADV;;AAGA,QAAGzD,CAAH,EAAM;AACF,aAAI,IAAIH,CAAR,IAAaG,CAAb,EAAe;AACX,gBAAG,CAACwJ,OAAOxJ,EAAEH,CAAF,CAAP,EAAasF,EAAb,CAAJ,EACI,OAAOnF,EAAEH,CAAF,CAAP;AACP;AACJ;;AAED,WAAO0B,CAAP;AACH,CAfM;;AAiBA,IAAM6I,0BAAS,SAATA,MAAS,CAAC8D,IAAD,EAAO/I,EAAP,EAAWkF,GAAX,EAAmB;AACrC,QAAG6D,KAAKnN,GAAL,KAAaW,SAAhB,EACI,OAAOyD,GAAGkF,GAAH,EAAQ6D,KAAKlB,GAAb,EAAkBkB,KAAKnN,GAAvB,CAAP;;AAEJ,QAAIf,IAAIkO,KAAKzK,QAAb;AACA,QAAGzD,CAAH,EAAM;AACF,aAAI,IAAIH,CAAR,IAAaG,CAAb;AACIqK,kBAAMD,OAAOpK,EAAEH,CAAF,CAAP,EAAasF,EAAb,EAAiBkF,GAAjB,CAAN;AADJ,SAGA,OAAOA,GAAP;AACH;AACJ,CAXM;;AAaA,IAAM4F,0BAAS,SAATA,MAAS,CAAC/B,IAAD,EAAgB;AAAA,QAATxF,CAAS,uEAAP,EAAO;;AAClC,QAAGwF,KAAKnN,GAAL,KAAaW,SAAhB,EAA2BgH,EAAE9D,IAAF,CAAOsJ,KAAKlB,GAAZ;;AAE3B,QAAIhN,IAAIkO,KAAKzK,QAAb;AACA,QAAGzD,CAAH,EAAM;AACF,aAAI,IAAIH,CAAR,IAAaG,CAAb,EAAgB;AACZiQ,mBAAOjQ,EAAEH,CAAF,CAAP,EAAa6I,CAAb;AACH;AACJ;;AAED,WAAOA,CAAP;AACH,CAXM;;AAaA,IAAMwH,wCAAgB,SAAhBA,aAAgB,CAAChC,IAAD,EAAgB;AAAA,QAATxF,CAAS,uEAAP,EAAO;;AACzC,QAAI7I,IAAI,CAAR;AAAA,QACIsN,UADJ;;AAGA,OAAG;AACCA,YAAIyC,IAAI1B,IAAJ,EAAUrO,GAAV,CAAJ;AACAsN,cAAMzL,SAAN,IAAmBgH,EAAE9D,IAAF,CAAOuI,CAAP,CAAnB;AACH,KAHD,QAGQA,CAHR;;AAKA,WAAOzE,CAAP;AACH,CAVM;;AAYA,IAAMyH,0BAAS,SAATA,MAAS,CAACjC,IAAD,EAAgB;AAAA,QAATxF,CAAS,uEAAP,EAAO;;AAClC,QAAGwF,KAAKnN,GAAL,KAAaW,SAAhB,EACIgH,EAAEwF,KAAKnN,GAAP,IAAcmN,KAAKlB,GAAnB;;AAEJ,QAAIhN,IAAIkO,KAAKzK,QAAb;AACA,QAAGzD,CAAH,EAAM;AACF,aAAI,IAAIH,CAAR,IAAaG,CAAb,EAAgB;AACZoQ,mBAAOpQ,EAAEH,CAAF,CAAP,EAAa6I,CAAb;AACH;AACJ;;AAED,WAAOA,CAAP;AACH,CAZM;;AAcA,IAAM9D,sBAAO,SAAPA,IAAO,CAACsJ,IAAD,EAAOlB,GAAP;AAAA,WAAegC,IAAId,IAAJ,EAAUD,SAASC,IAAT,CAAV,EAA0BlB,GAA1B,CAAf;AAAA,CAAb;;AAEA,IAAMqD,oBAAM,SAANA,GAAM;AAAA,WAAQP,MAAM5B,IAAN,EAAYD,SAASC,IAAT,IAAe,CAA3B,CAAR;AAAA,CAAZ;;AAEA,IAAMoC,wBAAQ,SAARA,KAAQ;AAAA,WAAQlG,OACzB0F,MAAM5B,IAAN,EAAY,CAAZ,CADyB,EAEzB,UAAC7D,GAAD,EAAK5K,CAAL,EAAO8Q,CAAP;AAAA,eAAavB,IAAI3E,GAAJ,EAASkG,IAAE,CAAX,EAAc9Q,CAAd,CAAb;AAAA,KAFyB,EAGzBqP,MAHyB,CAAR;AAAA,CAAd;;AAKA,IAAMjL,4BAAU,SAAVA,OAAU,CAACqK,IAAD,EAAOlB,GAAP;AAAA,WACnBgC,IACI5E,OACI8D,IADJ,EAEI,UAAC7D,GAAD,EAAK5K,CAAL,EAAO8Q,CAAP;AAAA,eAAavB,IAAI3E,GAAJ,EAASkG,IAAE,CAAX,EAAc9Q,CAAd,CAAb;AAAA,KAFJ,EAGIqP,MAHJ,CADJ,EAKI,CALJ,EAMI9B,GANJ,CADmB;AAAA,CAAhB;;AASA,IAAM3N,sBAAOyP,IAAb;;AAEP;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;ACvVA,IAAM0B,WAAW,SAAXA,QAAW;AAAA,sCAAIC,CAAJ;AAAIA,SAAJ;AAAA;;AAAA,WAAU;AAAA,eACvBA,EAAErG,MAAF,CAAS,UAACC,GAAD,EAAKjI,CAAL;AAAA,mBACLiI,OACIqG,OAAOtO,CAAP,MAAcV,SAAf,IACA,gBAAgBO,IAAhB,CAAqByO,OAAOtO,CAAP,IAAU,EAA/B,CADA,IAEAsO,OAAOtO,CAAP,CAJE;AAAA,SAAT,EAKE,KALF,CADuB;AAAA,KAAV;AAAA,CAAjB;;AAQA,IAAMuO,kBAAkBH,SAAS,QAAT,CAAxB;;AAEA,IAAMI,gBAAgBJ,SAAS,MAAT,CAAtB;;AAEA,IAAMK,eAAeL,SAAS,KAAT,EAAgB,WAAhB,CAArB;;AAEA,IAAMM,mBAAmBN,SAAS,aAAT,EAAwB,mBAAxB,EAA6C,gBAA7C,CAAzB;;AAEA;;;;;AAKO,IAAMlR,0BAAS,SAATA,MAAS,GAAa;AAAA,uCAATyR,IAAS;AAATA,YAAS;AAAA;;AAC/B,QAAG,CAACJ,iBAAJ,EAAuB,MAAM,0BAAN;;AAEvBI,SAAKA,KAAKhR,MAAL,GAAY,CAAjB,wBAAwCgR,KAAKA,KAAKhR,MAAL,GAAY,CAAjB,CAAxC;;AAEA,QAAMiR,IAAIJ,eAAV;AAAA,QACMK,IAAIH,kBADV;AAAA,QAEMI,IAAIL,cAFV;;AAIA,QAAIM,aAAJ;;AAEA,QAAGP,eAAH,EAAoB;AAChBO,eACI,IAAIH,CAAJ,CAAMD,KAAKhM,GAAL,CAAS;AAAA,mBAAK/E,IAAE,EAAP;AAAA,SAAT,CAAN,EACA,EAAC+L,MAAM,wBAAP,EADA,CADJ;AAIH,KALD,MAKO,IAAGkF,CAAH,EAAK;AACRE,eAAO,IAAIF,CAAJ,EAAP;AACAF,aAAKhM,GAAL,CAAS;AAAA,mBAAKoM,KAAKC,MAAL,CAAYpR,IAAE,EAAd,CAAL;AAAA,SAAT;AACAmR,eAAOA,KAAKE,OAAL,EAAP;AACH,KAJM,MAIA;AACHF,eAAO,uCACCG,mBACAP,KAAK3G,MAAL,CAAY,UAACC,GAAD,EAAKrK,CAAL;AAAA,mBAAWqK,MAAIrK,CAAf;AAAA,SAAZ,EAA8B,EAA9B,CADA,CADD,CAAP;AAIH;;AAED,QAAIY,MAAMsQ,EAAEK,eAAF,CAAkBJ,IAAlB,CAAV;AACA,WAAO,IAAIK,MAAJ,CAAW5Q,GAAX,CAAP;AACH,CA7BM;;AA+BA,IAAM6Q,sBAAO,SAAPA,IAAO,CAACtE,CAAD,EAAgB;AAAA,uCAAT4D,IAAS;AAATA,YAAS;AAAA;;AAChC,QAAIW,UAAU/N,MAAMwJ,CAAN,EAASwE,IAAT,CAAc,CAAd,EAAiB5M,GAAjB,CAAqB;AAAA,eAAKzF,wBAAUyR,IAAV,CAAL;AAAA,KAArB,CAAd;AAAA,QACMa,UAAU,CADhB;AAAA,QAEMC,OAAO,SAAPA,IAAO,GAAM;AACX,YAAI9B,KAAK6B,OAAT;AACA,UAAEA,OAAF,IAAazE,CAAb,KAAmByE,UAAU,CAA7B;AACA,eAAOA,OAAP;AACH,KANL;AAAA,QAOMjF,aAPN;AAAA,QAQMmF,gBARN;;AAUAJ,YAAQ3M,GAAR,CAAY,aAAK;AACbgN,UAAEC,SAAF,GAAc;AAAA,mBAAKrF,gBAAgB/I,QAAhB,IAA4B+I,KAAKlL,EAAEE,IAAP,CAAjC;AAAA,SAAd;AACAoQ,UAAED,OAAF,GAAY;AAAA,mBAAKA,mBAAmBlO,QAAnB,IAA+BkO,QAAQrQ,CAAR,CAApC;AAAA,SAAZ;AACH,KAHD;;AAKA,QAAMU,OAAO,SAAPA,IAAO,GAAa;AAAA,2CAATe,IAAS;AAATA,gBAAS;AAAA;;AACtB,YAAI6O,IAAIL,QAAQG,MAAR,CAAR;AACAE,aAAKA,EAAEE,WAAF,CAAc/O,IAAd,CAAL;AACH,KAHD;;AAKAf,SAAKwK,IAAL,GAAY,cAAM;AACdA,eAAOxH,EAAP;AACA,eAAOhD,IAAP;AACH,KAHD;AAIAA,SAAKN,KAAL,GAAa,cAAM;AACfiQ,kBAAU3M,EAAV;AACA,eAAOhD,IAAP;AACH,KAHD;AAIA,WAAOA,IAAP;AACH,CA9BM","file":"","sourcesContent":["import batch from './batch'\nimport vdom from './vdom'\nimport mixin from './mixin'\nimport model from './model'\nimport obs from './observable'\nimport * as hamt from './hamt'\nimport * as worker from './worker'\nimport * as fp from './fp'\n\nexport const hash = (v,_v=JSON.stringify(v)) => {\n    let hash = 0\n    for (let i = 0, len = _v.length; i < len; ++i) {\n        const c = _v.charCodeAt(i)\n        hash = (((hash << 5) - hash) + c) | 0\n    }\n    return hash\n}\n\nmodule.exports = Object.assign({}, fp, {\n\tbatch\n\t, vdom\n\t, mixin\n\t, model\n\t, obs\n\t, hamt\n\t, worker\n})\n","\n// batched requests\n// The `fetch()` module batches in-flight requests, so if at any point in time, anywhere in my front-end or\n// back-end application I have a calls occur to `fetch('http://api.github.com/users/matthiasak')` while another\n// to that URL is \"in-flight\", the Promise returned by both of those calls will be resolved by a single network request.\n\n// f :: (url -> options) -> Promise\nconst batch = f => {\n    let inflight = {}\n\n    return (url, options={}) => {\n        let {method} = options,\n            key = `${url}:${JSON.stringify(options)}`\n\n        if((method || '').toLowerCase() === 'post')\n            return f(url, Object.assign({}, options, {compress: false}))\n\n        return inflight[key] ||\n            (inflight[key] =\n                new Promise((res,rej) => {\n                    f(url, Object.assign({}, options, {compress: false}))\n                    .then(d => res(d))\n                    .catch(e => rej(e))\n                })\n                .then(data => {\n                    inflight = Object.assign({}, inflight, {[key]: undefined})\n                    return data\n                })\n                .catch(e =>\n                    console.error(e, url)))\n    }\n}\n\nexport default batch","import {rAF} from './fp'\n\n// Virtual DOMs\nconst vdom = () => {\n    const class_id_regex = () => {\n            return /[#\\.][^#\\.]+/ig\n        },\n        tagName_regex = () => {\n            return /^([^\\.#]+)\\b/i\n        }\n\n    const parseSelector = s => {\n        let test = null,\n            tagreg = tagName_regex().exec(s),\n            tag = tagreg && tagreg.slice(1)[0],\n            reg = class_id_regex(),\n            vdom = Object.create(null)\n\n        if(tag) s = s.substr(tag.length)\n        vdom.className = ''\n        vdom.tag = tag || 'div'\n\n        while((test = reg.exec(s)) !== null){\n            test = test[0]\n            if(test[0] === '.')\n                vdom.className = (vdom.className+' '+test.substr(1)).trim()\n            else if(test[0] === '#')\n                vdom.id = test.substr(1)\n        }\n        return vdom\n    }\n\n    const debounce = (func, wait, immediate, timeout) =>\n        (...args) => {\n            let later = () => {\n                timeout = null\n                !immediate && func(...args)\n            }\n            var callNow = immediate && !timeout\n            clearTimeout(timeout)\n            timeout = setTimeout(later, wait || 0)\n            callNow && func(...args)\n        }\n\n    const hash = (v,_v=JSON.stringify(v)) => {\n        let hash = 0\n        for (let i = 0, len = _v.length; i < len; ++i) {\n            const c = _v.charCodeAt(i)\n            hash = (((hash << 5) - hash) + c) | 0\n        }\n        return hash\n    }\n\n    const m = (selector, attrs=Object.create(null), ...children) => {\n        if(attrs.tag || !(typeof attrs === 'object') || attrs instanceof Array || attrs instanceof Function){\n            if(attrs instanceof Array) children.unshift(...attrs)\n            else children.unshift(attrs)\n            attrs = Object.create(null)\n        }\n        let vdom = parseSelector(selector)\n        if(children.length)\n            vdom.children = children\n        vdom.attrs = attrs\n        vdom.shouldUpdate = attrs.shouldUpdate\n        vdom.unload = attrs.unload\n        vdom.config = attrs.config\n        vdom.__hash = hash(vdom)\n        delete attrs.unload\n        delete attrs.shouldUpdate\n        delete attrs.config\n        return vdom\n    }\n\n    // creatign html, strip events from DOM element... for now just deleting\n    const stripEvents = ({attrs}) => {\n        let a = Object.create(null)\n\n        if(attrs){\n            for(var name in attrs){\n                if(name[0]==='o'&&name[1]==='n') {\n                    a[name] = attrs[name]\n                    delete attrs[name]\n                }\n            }\n        }\n\n        return a\n    }\n\n    const applyEvents = (events, el, strip_existing=true) => {\n        strip_existing && removeEvents(el)\n        for(var name in events){\n            el[name] = events[name]\n        }\n    }\n\n    const flatten = (arr, a=[]) => {\n        for(var i=0,len=arr.length; i<len; i++){\n            let v = arr[i]\n            if(!(v instanceof Array)){\n                a.push(v)\n            } else {\n                flatten(v, a)\n            }\n        }\n        return a\n    }\n\n    const EVENTS = 'mouseover,mouseout,wheel,mousemove,blur,focus,click,abort,afterprint,animationend,animationiteration,animationstart,beforeprint,canplay,canplaythrough,change,contextmenu,dblclick,drag,dragend,dragenter,dragleave,dragover,dragstart,drop,durationchange,emptied,ended,error,load,input,invalid,keydown,keypress,keyup,loadeddata,loadedmetadata,mousedown,mouseenter,mouseleave,mouseup,pause,pointercancel,pointerdown,pointerenter,pointerleave,pointermove,pointerout,pointerover,pointerup,play,playing,ratechange,reset,resize,scroll,seeked,seeking,select,selectstart,selectionchange,show,submit,timeupdate,touchstart,touchend,touchcancel,touchmove,touchenter,touchleave,transitionend,volumechange,waiting'.split(',').map(x => 'on'+x)\n\n    const removeEvents = el => {\n        // strip away event handlers on el, if it exists\n        if(!el) return;\n        for(var i in EVENTS){\n            el[i] = null\n        }\n    }\n\n    let mnt\n\n    const mount = (fn, el) => {\n        mnt = [el, fn]\n        render(fn, el)\n    }\n\n    const render = debounce((fn, el) => rAF(_ => {\n        applyUpdates(fn, el.children[0], el)\n    }))\n\n    const update = () => {\n        if(!mnt) return\n        let [el, fn] = mnt\n        render(fn, el)\n    }\n\n    const stylify = style => {\n        let s = ''\n        for(var i in style){\n            s+=`${i}:${style[i]};`\n        }\n        return s\n    }\n\n    const setAttrs = ({attrs, id, className, __hash},el) => {\n    \tel.className = ''\n    \tel.style = ''\n\n        if(attrs){\n            for(var attr in attrs){\n                if(attr === 'style') {\n                    el.style = stylify(attrs[attr])\n                } else if(attr === 'innerHTML'){\n                    rAF(() => el.innerHTML = attrs[attr])\n                } else if(attr === 'value'){\n                    rAF(() => el.value = attrs[attr])\n                } else {\n                    el.setAttribute(attr, attrs[attr])\n                }\n            }\n        }\n        let _id = attrs.id || id\n        if(_id) el.id = _id\n        let _className = ((attrs.className || '') + ' ' + (className || '')).trim()\n        if(_className) el.className = _className\n        el.__hash = __hash\n    }\n\n    // recycle or create a new el\n    const createTag = (vdom=Object.create(null), el, parent=el&&el.parentElement) => {\n        let __vdom = vdom\n        // make text nodes from primitive types\n        if(typeof vdom !== 'object'){\n            let t = document.createTextNode(vdom)\n            if(el){\n                parent.insertBefore(t,el)\n                removeEl(el)\n            } else {\n                parent.appendChild(t)\n            }\n            return t\n        }\n\n        // else make an HTMLElement from \"tag\" types\n        let {tag, attrs, id, className, unload, shouldUpdate, config, __hash} = vdom,\n            shouldExchange = !el || !el.tagName || (tag && el.tagName.toLowerCase() !== tag.toLowerCase()),\n            _shouldUpdate = !(shouldUpdate instanceof Function) || shouldUpdate(el)\n\n        if(!attrs) return\n        if(el && (!_shouldUpdate || ((!vdom instanceof Function) && el.__hash === __hash))) {\n            return\n        }\n\n        if(shouldExchange){\n            let t = document.createElement(tag)\n            el ? (parent.insertBefore(t, el), removeEl(el)) : parent.appendChild(t)\n            el = t\n        }\n\n        setAttrs(vdom, el)\n        if(el.unload instanceof Function) {\n            rAF(el.unload)\n        }\n        if(unload instanceof Function) {\n            el.unload = unload\n        }\n        applyEvents(stripEvents(vdom), el)\n        config && rAF(_ => config(el))\n        return el\n    }\n\n    // find parent element, and remove the input element\n    const removeEl = el => {\n        if(!el) return\n        el.parentElement.removeChild(el)\n        removeEvents(el)\n        // removed for now, added unload logic to the immediate draw()s\n        if(el.unload instanceof Function)\n            el.unload()\n    }\n\n    const insertAt = (el, parent, i) => {\n        if(parent.children.length > i) {\n            let next_sib = parent.children[i]\n            parent.insertBefore(el, next_sib)\n        } else {\n            parent.appendChild(el)\n        }\n    }\n\n    const applyUpdates = (vdom, el, parent=el&&el.parentElement) => {\n        let v = vdom\n        // if vdom is a function, execute it until it isn't\n        while(vdom instanceof Function)\n            vdom = vdom()\n\n        if(!vdom) return\n\n        if(vdom.resolve instanceof Function){\n            let i = parent.children.length\n            return vdom.resolve().then(v => {\n                if(!el) {\n                    let x = createTag(v, null, parent)\n                    insertAt(x, parent, i)\n                    applyUpdates(v, x, parent)\n                } else {\n                    applyUpdates(v, el, parent)\n                }\n            })\n        }\n\n        // create/edit el under parent\n        let _el = vdom instanceof Array ? parent : createTag(vdom, el, parent)\n\n        if(!_el) return\n\n        if(vdom instanceof Array || vdom.children){\n            let vdom_children = flatten(vdom instanceof Array ? vdom : vdom.children),\n                el_children = vdom instanceof Array ? parent.childNodes : _el.childNodes\n\n            while(el_children.length > vdom_children.length){\n                removeEl(el_children[el_children.length-1])\n            }\n\n            for(let i=0; i<vdom_children.length; i++){\n                applyUpdates(vdom_children[i],el_children[i],_el)\n            }\n        } else {\n            while(_el.childNodes.length > 0){\n                removeEl(_el.childNodes[_el.childNodes.length-1])\n            }\n        }\n    }\n\n    const qs = (s='body', el=document) => el.querySelector(s)\n\n    const resolver  = (states = {}) => {\n        let promises = [],\n            done = false\n\n        const _await = (_promises = []) => {\n            promises = [...promises, ..._promises]\n            return finish()\n        }\n\n        const wait = (ms=0) => new Promise(res => setTimeout(res, ms))\n\n        const isDone = () => done\n\n        const finish = () => {\n            const total = promises.length\n            return wait().then(_ => Promise.all(promises)).then(values => {\n                if(promises.length > total){\n                    return finish()\n                }\n                done = true\n                return states\n            })\n        }\n\n        const resolve = (props) => {\n            const keys = Object.keys(props)\n            if (!keys.length)\n                return Promise.resolve(true)\n\n            let f = []\n            keys.forEach(name => {\n                let x = props[name]\n\n                while(x instanceof Function)\n                    x = x()\n\n                if(x && x.then instanceof Function)\n                    f.push(x.then(d => states[name] = d))\n            })\n\n            return _await(f)\n        }\n\n        const getState = () => states\n\n        return { finish, resolve, getState, promises, isDone }\n    }\n\n    const gs = (view, state) => {\n        let r = view(state)\n        while(r instanceof Function)\n            r = view(instance.getState())\n        return r\n    }\n\n    const container = (view, queries={}, instance=resolver()) => {\n        let wrapper_view = state =>\n            instance.isDone() ? view(state) : m('span')\n\n        return () => {\n            let r = gs(wrapper_view, instance.getState())\n            instance.resolve(queries)\n\n            if(r instanceof Array) {\n                let d = instance.finish().then(_ =>\n                    gs(wrapper_view, instance.getState()))\n\n                return r.map((x,i) => {\n                    x.resolve = _ => d.then(vdom => vdom[i])\n                    return x\n                })\n            }\n\n            r.resolve = _ => instance.finish().then(_ =>\n                gs(wrapper_view, instance.getState()))\n\n            return r\n        }\n    }\n\n    const reservedAttrs = ['className','id']\n\n    const toHTML = _vdom => {\n        while(_vdom instanceof Function) _vdom = _vdom()\n        if(_vdom instanceof Array) return new Promise(r => r(html(..._vdom)))\n        if(!_vdom) return new Promise(r => r(''))\n        if(typeof _vdom !== 'object') return new Promise(r => r(_vdom))\n        return (_vdom.resolve ? _vdom.resolve() : Promise.resolve()).then(vdom => {\n            if(!vdom) vdom = _vdom\n\n            if(vdom instanceof Array) return new Promise(r => r(html(...vdom)))\n\n            const {tag, id, className, attrs, children, instance} = vdom,\n                _id = (id || (attrs && attrs.id)) ? ` id=\"${(id || (attrs && attrs.id) || '')}\"` : '',\n                _class = (className || (attrs && attrs.className)) ? ` class=\"${((className||'') + ' ' + (attrs.className||'')).trim()}\"` : ''\n\n            const events = stripEvents(vdom)\n            let _attrs = '',\n                inner = ''\n            for(var i in (attrs || Object.create(null))){\n                if(i === 'style'){\n                    _attrs += ` style=\"${stylify(attrs[i])}\"`\n                } else if(i === 'innerHTML') {\n                    inner = attrs[i]\n                } else if(reservedAttrs.indexOf(i) === -1){\n                    _attrs += ` ${i}=\"${attrs[i]}\"`\n                }\n            }\n\n            if(!inner && children)\n                return html(...children).then(str =>\n                    `<${tag}${_id}${_class}${_attrs}>${str}</${tag}>`)\n\n            if('br,input,img'.split(',').filter(x => x===tag).length === 0)\n                return new Promise(r => r(`<${tag}${_id}${_class}${_attrs}>${inner}</${tag}>`))\n\n            return new Promise(r => r(`<${tag}${_id}${_class}${_attrs} />`))\n        })\n    }\n\n    const html = (...v) => Promise.all(v.map(toHTML)).then(x => x.filter(x => !!x).join(''))\n\n    return {container, html, qs, update, mount, m, debounce}\n}\n\nmodule.exports = vdom()\n\n/*\nusage:\n\nlet component = () =>\n    new Array(20).fill(true).map(x =>\n        m('div', {onMouseOver: e => log(e.target.innerHTML)}, range(1,100)))\n\nclient-side\n-----\nmount(component, qs())\n\nclient-side constant re-rendering\n-----\nconst run = () => {\n    setTimeout(run, 20)\n    update()\n}\nrun()\n*/\n\n/* CONTAINER / HTML USAGE (Server-side rendering)\n\nconst name = _ => new Promise(res => setTimeout(_ => res('matt'), 1500))\n\nlet x = container(data => [\n        m('div.test.row', {className:'hola', 'data-name':data.name, style:{border:'1px solid black'}}),\n        m('div', data.name),\n    ],\n    {name}\n)\n\nhtml(x).then(x => log(x)).catch(e => log(e+''))\n*/\n","export const log = (...a) => console.log(...a)\n\n// rAF\nexport const rAF =\n      !!global.document &&\n      (global.requestAnimationFrame ||\n      global.webkitRequestAnimationFrame ||\n      global.mozRequestAnimationFrame) ||\n      (cb => setTimeout(cb, 16.6))\n\n// composition\n// c :: (T -> U) -> (U -> V) -> (T -> V)\nexport const c = (f,g) => x => f(g(x))\n\n// cof :: [(an -> bn)] -> a0 -> bn\n// compose forward\nexport const cof = (...fns) => fns.reduce((acc,fn) => c(acc, fn))\n\n// cob :: [(an -> bn)] -> b0 -> an\n// compose backwards\nexport const cob = (...fns) => cof(...fns.reverse())\n\n// functional utilities\n// pointfree\nexport const pf = fn => (...args) => x => fn.apply(x, args)\n\n// curry\n// curry :: (T -> U) -> [args] -> ( -> U)\nexport const curry = (fn, ...args) =>\n\tfn.bind(undefined, ...args)\n\n\n// Transducers\nexport const mapping = (mapper) => // mapper: x -> y\n    (reducer) => // reducer: (state, value) -> new state\n        (result, value) =>\n            reducer(result, mapper(value))\n\nexport const filtering = (predicate) => // predicate: x -> true/false\n    (reducer) => // reducer: (state, value) -> new state\n        (result, value) =>\n            predicate(value) ? reducer(result, value) : result\n\nexport const concatter = (thing, value) =>\n    thing.concat([value])\n","\nconst mixin = (...classes) => {\n    class _mixin {}\n\n    let proto = _mixin.prototype\n\n    classes.map(({prototype:p}) => {\n        Object.getOwnPropertyNames(p).map(key => {\n            let oldFn = proto[key] || ($ => {})\n            proto[key] = function() {\n                oldFn.apply(null, [].slice.call(arguments))\n                return p[key].apply(null, [].slice.call(arguments))\n            }\n        })\n    })\n\n    return _mixin\n}\n\nmodule.exports = mixin","// Validate JS objects for their \"shape\"\nconst model = {\n    is(type, value) {\n        if(type && type.isValid instanceof Function){\n            return type.isValid(value)\n        } else if((type === String && ((value instanceof String) || typeof value === 'string'))\n            || (type === Number && ((value instanceof Number) || typeof value === 'number'))\n            || (type === Boolean && ((value instanceof Boolean) || typeof value === 'boolean'))\n            || (type === Function && ((value instanceof Function) || typeof value === 'function'))\n            || (type === Object && ((value instanceof Object) || typeof value === 'object'))\n            || (type === undefined)\n        ){\n            return true\n        }\n\n        return false\n    },\n    check(types, required, data) {\n        Object.keys(types).forEach(key => {\n            let t = types[key],\n                value = data[key]\n\n            if(required[key] || value !== undefined){\n                if(!(t instanceof Array)) t = [t]\n\n                let i = t.reduce((a,_type) => a || MODEL.is(_type, value), false)\n                if(!i) {\n                    throw `{${key}: ${JSON.stringify(value)}} is not one of ${t.map(x => `\\n - ${x}`)}`\n                }\n            }\n        })\n\n        return true\n    },\n    init(...args) {\n        let types, required, logic\n        args.map(x => {\n            if(x instanceof Function && !logic){ logic = x }\n            else if(typeof x === 'object') {\n                if(!types){ types = x }\n                else if(!required){ required = x }\n            }\n        })\n\n        const isValid = (data) => {\n            const pipe = logic ? [check, logic] : [check]\n            return pipe.reduce((a,v) => a && v(types||{},required||{},data), true)\n        }\n\n        const whenValid = (data) => new Promise((res,rej) => isValid(data) && res(data))\n\n        return {isValid, whenValid}\n    },\n    ArrayOf(M) {\n        return MODEL.init((t,r,data) => {\n            if(!(data instanceof Array)) throw `${data} not an Array`\n            data.map(x => {\n                if(!MODEL.is(M, x))\n                    throw `${x} is not a model instance`\n            })\n            return true\n        })\n    }\n}\n\nexport default model\n\n/**\nUse it\n\n// create a Name model with required first/last,\n// but optional middle\nlet Name = MODEL.init({\n    first: String,\n    middle: String,\n    last: String\n}, {first:true, last:true})\n\n// create a Tags model with extra checks\nlet Tags = MODEL.init((types,required,data) => {\n    if(!(data instanceof Array)) throw `${data} not an Array`\n    data.map(x => {\n        if(!is(String, x))\n            throw `[${data}] contains non-String`\n    })\n    return true\n})\n\n// create a Price model that just has a business logic fn\nlet Price = MODEL.init((t,r,d) => {\n    return (d instanceof Number || typeof d === 'number') && d !== 0\n})\n\n// create an Activity model with a required type and name,\n// all others optional\nlet Activity = MODEL.init({\n    type: [String, Function, Number],\n    latlng: Array,\n    title: String,\n    tags: Tags,\n    name: Name,\n    price: Price\n}, {name:true, price: true})\n\n// create a new Activity instance, throwing errors if there are\n// any invalid fields.\nlet a = {\n    tags: ['1','2'],\n    type: 1,\n    name: {first:'matt',last:'keas'},\n    price: 100.43,\n    url: 'http://www.google.com'\n}\nActivity.whenValid(a).then(log).catch(e => log(e+''))\n**/\n","// async-supporting-observables\nconst obs = (state) => {\n    let subscribers = []\n\n    const fn = (val) => {\n        if(val !== undefined){\n            state = val\n            for(let i = 0, len = subscribers.length; i<len; i++)\n            \tsubscribers[i](val)\n        }\n        return state\n    }\n\n    fn.map = f => {\n      const o = obs()\n      subscribers.push(val => o(f(val)))\n      return o\n    }\n\n    fn.filter = f => {\n      const o = obs()\n      subscribers.push(val => f(val) && o(val))\n      return o\n    }\n\n    fn.then = f => {\n      subscribers.push(val => f(val))\n      return fn\n    }\n\n    fn.take = (n) => {\n        const values = [],\n        \to = obs()\n\n        const cb = val => {\n            if(values.length < n)\n                values.push(val)\n\n            if(values.length === n) {\n                subscribers.delete(cb)\n                return o(values)\n            }\n        }\n\n        subscribers.push(cb)\n\n        return o\n    }\n\n    fn.takeWhile = f => {\n        const values = [],\n        \to = obs()\n\n        const cb = val => {\n            if(!f(val)) {\n                subscribers = subscribers.filter(x => x !== cb)\n                return o(values)\n            }\n\n\t\t\tvalues.push(val)\n        }\n\n        subscribers.push(cb)\n\n        return o\n    }\n\n    fn.reduce = (f,acc) => {\n        const o = obs()\n\n        subscribers.push(val => {\n            acc = f(acc,val)\n            o(acc)\n        })\n\n        return o\n    }\n\n    fn.maybe = f => {\n        const success = obs(),\n              error = obs(),\n              cb = val =>\n        \t\tf(val)\n\t\t\t\t    .then(d => success(d))\n                    .catch(e => error(e))\n\n        subscribers.push(cb)\n\n        return [ success, error ]\n    }\n\n    fn.stop = () => subscribers = []\n\n    fn.debounce = ms => {\n        const o = obs()\n        let ts = +new Date\n        subscribers.push(val => {\n            const now = +new Date\n            if(now - ts >= ms){\n                ts = +new Date\n                o(val)\n            }\n        })\n        return o\n    }\n\n    return fn\n}\n\nobs.from = f => {\n    const o = obs()\n    f(x => o(x))\n    return o\n}\n\nobs.union = (...fs) => {\n    const o = obs()\n    fs.map(f => f.then(o))\n    return o\n}\n\nexport default obs","// compute the hamming weight\nexport const hamming = x => {\n    x -= ((x >> 1) & 0x55555555)\n    x = (x & 0x33333333) + ((x >> 2) & 0x33333333)\n    x = (x + (x >> 4)) & 0x0f0f0f0f\n    x += (x >> 8)\n    x += (x >> 16)\n    return (x & 0x7f)\n}\n\nexport const popcount = root => {\n    if(root.key)\n        return 1\n\n    let c = root.children\n    if(c) {\n        var sum = 0\n        for(var i in c) sum += popcount(c[i])\n        return sum\n    }\n}\n\n// hash fn\nexport const hash = (v='') => {\n    v = JSON.stringify(v)\n    var hash = 5381\n    for (let i = 0; i < v.length; i++)\n        hash = ((hash << 5) + hash) + v.charCodeAt(i)\n    return hash\n}\n\n// compare two hashes\nexport const comp = (a,b) => hash(a) === hash(b)\n\n// get a bit vector\nexport const HMAP_SIZE = 8\nexport const MAX_DEPTH = 32 / HMAP_SIZE - 1\nexport const vec = (h=0, i=0, range=HMAP_SIZE) => (h >>> (range*i)) & ((1 << range) - 1)\n\nexport const shallowClone = x => {\n    let y = Object.create(null)\n    for(let i in x)\n        y[i] = x[i]\n    return y\n}\n\nexport const cloneNode = x => {\n    let y = node()\n    if(!x) return y\n\n    if(x.children) {\n        y.children = shallowClone(x.children)\n    } else if(x.key !== undefined) {\n        y.key = x.key\n        y.val = x.val\n        y.hash = x.hash\n    }\n\n    return y\n}\n\nexport const numChildren = x => {\n    let c = 0\n    for(var i in x) ++c\n    return c\n}\n\nexport const set = (root, key, val) => {\n    if((root.key === undefined) && !root.children) return node(key, val)\n\n    const newroot = cloneNode(root), h = hash(key)\n\n    // walk the tree\n    for(var i = 3, r = root, n = newroot; i >= 0; --i){\n        let bits = vec(h, i)\n\n        if(r.key !== undefined){\n            // if we have a collision\n            if(r.key === key || i === 0) {\n                // if keys match or is leaf, just overwrite n's val\n                n.val = val\n            } else if(i !== 0) {\n                // else if r is not at max depth and keys don't match\n                // add levels to both trees, new tree must be able\n                // to access old data\n\n                // 0. create makeshift value node for r\n                // and new value node for n\n                let cp = node(r.key, r.val, r.hash)\n                let cn = node(key, val, h)\n                let rh = r.hash\n\n                // 1. delete value props from nodes\n                delete r.key\n                delete r.val\n                delete r.hash\n                delete n.key\n                delete n.val\n                delete n.hash\n\n                // 2. create layers until bit-vectors don't collide\n                for(let j = i, __r = r, __n = n; j >= 0; j--){\n                    let vecr = vec(rh, j),\n                        vecn = vec(h, j)\n\n                    // create new layer for c and r\n                    let c = __r.children = Object.create(null)\n                    let d = __n.children = shallowClone(c)\n\n                    if(vecr !== vecn) {\n                        c[vecr] = cp\n                        d[vecr] = cp\n                        d[vecn] = cn\n                        break\n                    } else {\n                        __r = c[vecr] = node()\n                        __n = d[vecn] = cloneNode(__r)\n                    }\n                }\n            }\n            break\n        } else if(r.children) {\n            let _r = r.children[bits]\n            if(!_r) {\n                n = n.children[bits] = node(key, val)\n                break\n            } else {\n                r = _r\n                n = n.children[bits] = cloneNode(r)\n            }\n        }\n    }\n\n    return newroot\n}\n\nexport const get = (root, key) => {\n    if(root.key === key) return root.val\n    const h = hash(key)\n    for(let i = 3, r = root; i >= 0; --i){\n        if(!r.children) return undefined\n        r = r.children[vec(h, i)]\n        if(!r) return undefined\n        if(r.key !== undefined) return r.val\n    }\n\n    return undefined\n}\n\nexport const first = root => {\n    let c = root.children\n    for(let i in c) return c[i]\n}\n\nexport const unset = (root, key) => {\n    const n = cloneNode(root),\n          h = hash(key)\n\n    for(var i = 3, _n = n, p = n; i >= -1; --i) {\n        if(_n.key) {\n            delete _n.key\n            delete _n.val\n            delete _n.hash\n            return n\n\n//             let c = numChildren(p)\n\n//             if(c === 1) {\n//                 // if only child, delete child and parent?\n//                 delete p.children\n//             } else if(c===2){\n//                 // if 2 children, promote sibling as parent value nod\n//                 delete p.children[bits]\n//                 let sibling = first(p)\n//                 delete p.children\n//                 if(sibling.children){\n//                     p.children = sibling.children\n//                 } else if(p.key) {\n//                     p.val = sibling.val\n//                     p.hash = sibling.hash\n//                     p.key = sibling.key\n//                 }\n//             } else {\n//                 // if more than 2 children, just delete the one\n//                 delete p.children[bits]\n//             }\n//             return n\n        }\n\n        const bits = vec(h, i)\n        _n = _n && _n.children && _n.children[bits]\n        if(!_n) return n\n        p = _n\n    }\n    return n\n}\n\nexport const node = (key,val,h= key !== undefined && hash(key)) => {\n    /*\n    potential props of a tree node\n    - key - hashkey\n    - val - value\n    - children - { ... } -> points to other nodes (List<Node> children)\n    */\n\n    let item = Object.create(null)\n    if(key !== undefined){\n        item.key = key\n        item.hash = h\n        item.val = val\n    }\n    return item\n}\n\nexport const map = (root, fn) => {\n    if(root.key !== undefined)\n        return node(root.key, fn(root.val, root.key), root.hash)\n\n    let d = cloneNode(root),\n        c = d.children\n\n    if(c) {\n        for(var i in c){\n            c[i] = map(c[i], fn)\n        }\n    }\n\n    return d\n}\n\nexport const filter = (root, fn) => {\n    if(root.key !== undefined)\n        return fn(root.val, root.key) ? root : undefined\n\n    let d = cloneNode(root),\n        c = d.children\n\n    if(c) {\n        for(var i in c){\n            if(!filter(c[i], fn))\n                delete c[i]\n        }\n    }\n\n    return d\n}\n\nexport const reduce = (root, fn, acc) => {\n    if(root.key !== undefined)\n        return fn(acc, root.val, root.key)\n\n    let c = root.children\n    if(c) {\n        for(var i in c)\n            acc = reduce(c[i], fn, acc)\n\n        return acc\n    }\n}\n\nexport const toList = (root, r=[]) => {\n    if(root.key !== undefined) r.push(root.val)\n\n    let c = root.children\n    if(c) {\n        for(var i in c) {\n            toList(c[i], r)\n        }\n    }\n\n    return r\n}\n\nexport const toOrderedList = (root, r=[]) => {\n    let i = 0,\n        n\n\n    do {\n        n = get(root, i++)\n        n !== undefined && r.push(n)\n    } while(n)\n\n    return r\n}\n\nexport const toJSON = (root, r={}) => {\n    if(root.key !== undefined)\n        r[root.key] = root.val\n\n    let c = root.children\n    if(c) {\n        for(var i in c) {\n            toJson(c[i], r)\n        }\n    }\n\n    return r\n}\n\nexport const push = (root, val) => set(root, popcount(root), val)\n\nexport const pop = root => unset(root, popcount(root)-1)\n\nexport const shift = root => reduce(\n    unset(root, 0),\n    (acc,v,k) => set(acc, k-1, v),\n    node())\n\nexport const unshift = (root, val) =>\n    set(\n        reduce(\n            root,\n            (acc,v,k) => set(acc, k+1, v),\n            node()),\n        0,\n        val)\n\nexport const hamt = node\n\n// console.clear()\n// const l = (...args) => console.log(...args)\n// const j = (...a) => console.log(JSON.stringify(a))\n\n// let x = hamt()\n// let s = 20\n\n// Array(s).fill(1).map((v,i) => {\n//     x = set(x, i, i)\n// })\n\n// l(toList(x))\n// l(toJson(x))\n\n// x = map(x, x => log(x*x) || x*x)\n// l(get(x, 19))\n\n// l(x)\n// l(reduce(x, (acc, x) => acc+x, 0))\n\n// x = unset(x, 1)\n// Array(s).fill(1).map((_,i) => {\n//     if(!get(x, i)) l(i)\n//     // l(get(x, i))\n// })","const supports = (...q) => () =>\n    q.reduce((acc,s) =>\n        acc\n        || (window[s] !== undefined)\n        && /[native code]/.test(window[s]+'')\n        && window[s]\n    , false)\n\nconst supportsWorkers = supports('Worker')\n\nconst supportsBlobs = supports('Blob')\n\nconst supportsURLs = supports('URL', 'webkitURL')\n\nconst supportsBuilders = supports('BlobBuilder', 'WebKitBlobBuilder', 'MozBlobBuilder')\n\n/*\nworker:: [X] -> Worker where X : Function | String\n\nthe last X provided in the arguments will be setup as the handler for self.onmessage()\n*/\nexport const worker = (...code) => {\n    if(!supportsWorkers()) throw 'WebWorkers not supported'\n\n    code[code.length-1] = `self.onmessage=${code[code.length-1]}`\n\n    const B = supportsBlobs()\n        , U = supportsBuilders()\n        , W = supportsURLs()\n\n    let blob\n\n    if(supportsBlobs()) {\n        blob =\n            new B(code.map(c => c+''),\n            {type: 'application/javascript'})\n\n    } else if(U){\n        blob = new U\n        code.map(c => blob.append(c+''))\n        blob = blob.getBlob()\n    } else {\n        blob = `data:application/javascript,`\n            +`${encodeURIComponent(\n                code.reduce((acc,c) => acc+c, '')\n              )}`\n    }\n\n    let url = W.createObjectURL(blob)\n    return new Worker(url)\n}\n\nexport const farm = (n, ...code) => {\n    let workers = Array(n).fill(1).map(x => worker(...code))\n        , current = 0\n        , iter = () => {\n            let _n = current\n            ++current >= n && (current = 0)\n            return current\n        }\n        , pipe\n        , onerror\n\n    workers.map(w => {\n        w.onmessage = e => pipe instanceof Function && pipe(e.data)\n        w.onerror = e => onerror instanceof Function && onerror(e)\n    })\n\n    const exec = (...args) => {\n        let w = workers[iter()]\n        w && w.postMessage(args)\n    }\n\n    exec.pipe = fn => {\n        pipe = fn\n        return exec\n    }\n    exec.error = fn => {\n        onerror = fn\n        return exec\n    }\n    return exec\n}\n"]}